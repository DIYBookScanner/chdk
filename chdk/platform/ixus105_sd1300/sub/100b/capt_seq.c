#include "lolevel.h"
#include "platform.h"
#include "core.h"
#include "conf.h"

static long *nrflag = (long*)(0x5b10-0x08);  // Found @ ffd203a4 & ffd203c0

#include "../../../generic/capt_seq.c"

//** capt_seq_task  @ 0xFFC5F9DC 

void __attribute__((naked,noinline)) capt_seq_task() {
asm volatile (
      "STMFD   SP!, {R3-R9,LR} \n"
      "LDR     R6, =0x2850 \n"
      "LDR     R4, =0x349A0 \n"
      "MOV     R9, #1 \n"
      "MOV     R7, #0 \n"
"loc_FFC5F9F0:\n"
      "LDR     R0, [R6, #4] \n"
      "MOV     R2, #0 \n"
      "MOV     R1, SP \n"
      "BL      sub_FFC2936C \n"
      "TST     R0, #1 \n"
      "BEQ     loc_FFC5FA1C \n"
      "LDR     R1, =0x5B4 \n"
      "LDR     R0, =0xFFC5F594 \n"
      "BL      sub_FFC0EB14 \n"
      "BL      sub_FFC0EACC \n"
      "LDMFD   SP!, {R3-R9,PC} \n"
"loc_FFC5FA1C:\n"
      "LDR     R0, [SP] \n"
      "LDR     R1, [R0] \n"
      "CMP     R1, #0x1D \n"
      "ADDLS   PC, PC, R1, LSL #2 \n"
      "B       loc_FFC5FCA4 \n"
      "B       loc_FFC5FAA8 \n"
      "B       loc_FFC5FB0C \n"
      "B       loc_FFC5FB48 \n"
      "B       loc_FFC5FB5C \n"
      "B       loc_FFC5FB54 \n"
      "B       loc_FFC5FB64 \n"
      "B       loc_FFC5FB6C \n"
      "B       loc_FFC5FB74 \n"
      "B       loc_FFC5FBCC \n"
      "B       loc_FFC5FBF4 \n"
      "B       loc_FFC5FBD8 \n"
      "B       loc_FFC5FBE4 \n"
      "B       loc_FFC5FBEC \n"
      "B       loc_FFC5FBFC \n"
      "B       loc_FFC5FC04 \n"
      "B       loc_FFC5FC0C \n"
      "B       loc_FFC5FC14 \n"
      "B       loc_FFC5FC1C \n"
      "B       loc_FFC5FC28 \n"
      "B       loc_FFC5FC30 \n"
      "B       loc_FFC5FC38 \n"
      "B       loc_FFC5FC40 \n"
      "B       loc_FFC5FC48 \n"
      "B       loc_FFC5FC54 \n"
      "B       loc_FFC5FC5C \n"
      "B       loc_FFC5FC64 \n"
      "B       loc_FFC5FC6C \n"
      "B       loc_FFC5FC74 \n"
      "B       loc_FFC5FC80 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FAA8:\n"
      "BL      shooting_expo_iso_override\n"  		//added
      "BL      sub_FFC602EC \n"
       "BL      shooting_expo_param_override\n"  	// added
      "BL      sub_FFC5DAEC \n"
      "LDR     R0, [R4, #0x24] \n"
      "CMP     R0, #0 \n"
      "BEQ     loc_FFC5FCB0 \n"
      "BL      sub_FFC5F274 \n"
      "MOV     R5, R0 \n"
      "LDR     R0, [R4, #0x24] \n"
      "CMP     R0, #0 \n"
      "BEQ     loc_FFC5FAF0 \n"
      "MOV     R0, #0xC \n"
      "BL      sub_FFC640E0 \n"
      "TST     R0, #1 \n"
      "STRNE   R9, [R6, #0x10] \n"
      "LDRNE   R0, [R5, #8] \n"
      "ORRNE   R0, R0, #0x40000000 \n"
      "STRNE   R0, [R5, #8] \n"
      "BNE     loc_FFC5FCB0 \n"
"loc_FFC5FAF0:\n"
      "MOV     R0, R5 \n"
      "BL      sub_FFC5F518 \n"
      "MOV     R0, R5 \n"
//      "BL      sub_FFD20314 \n"   //original
      "BL      sub_FFD20314_my \n"  //patched
      "TST     R0, #1 \n"
      "STRNE   R9, [R6, #0x10] \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FB0C:\n"
      "LDR     R0, [R4, #0x24] \n"
      "CMP     R0, #0 \n"
      "BNE     loc_FFC5FB38 \n"
      "MOV     R0, #0xC \n"
      "BL      sub_FFC640E0 \n"
      "TST     R0, #1 \n"
      "LDRNE   R0, [SP] \n"
      "MOVNE   R1, #1 \n"
      "LDRNE   R2, [R0, #0xC] \n"
      "MOVNE   R0, #1 \n"
      "BNE     loc_FFC5FBC4 \n"
"loc_FFC5FB38:\n"
      "LDR     R0, [SP] \n"
//      "BL      loc_FFC5FDC8 \n"   //original
      "BL      sub_FFC5FDC8_my\n"   //patched
"loc_FFC5FB40:\n"
      "STR     R7, [R4, #0x24] \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FB48:\n"
      "MOV     R0, #1 \n"
      "BL      sub_FFC60574 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FB54:\n"
      "BL      sub_FFC5FF40 \n"
      "B       loc_FFC5FB40 \n"
"loc_FFC5FB5C:\n"
      "BL      sub_FFC602CC \n"
      "B       loc_FFC5FB40 \n"
"loc_FFC5FB64:\n"
      "BL      sub_FFC602D4 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FB6C:\n"
      "BL      sub_FFC60484 \n"
      "B       loc_FFC5FBD0 \n"
"loc_FFC5FB74:\n"
      "LDR     R5, [R0, #0xC] \n"
      "BL      sub_FFC602DC \n"
      "MOV     R0, R5 \n"
      "BL      sub_FFD1F30C \n"
      "TST     R0, #1 \n"
      "MOV     R8, R0 \n"
      "BNE     loc_FFC5FBB4 \n"
      "BL      sub_FFC70D3C \n"
      "STR     R0, [R5, #0x18] \n"
      "MOV     R0, R5 \n"
      "BL      sub_FFD2024C \n"
      "MOV     R0, R5 \n"
      "BL      sub_FFD205F0 \n"
      "MOV     R8, R0 \n"
      "LDR     R0, [R5, #0x18] \n"
      "BL      sub_FFC70F74 \n"
"loc_FFC5FBB4:\n"
      "BL      sub_FFC602CC \n"
      "MOV     R2, R5 \n"
      "MOV     R1, #9 \n"
      "MOV     R0, R8 \n"
"loc_FFC5FBC4:\n"
      "BL      sub_FFC5DF60 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FBCC:\n"
      "BL      sub_FFC604EC \n"
"loc_FFC5FBD0:\n"
      "BL      sub_FFC5DAEC \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FBD8:\n"
      "LDR     R0, [R4, #0x54] \n"
      "BL      sub_FFC608DC \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FBE4:\n"
      "BL      sub_FFC60B90 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FBEC:\n"
      "BL      sub_FFC60C24 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FBF4:\n"
      "BL      sub_FFC602CC \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FBFC:\n"
      "BL      sub_FFD1F538 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC04:\n"
      "BL      sub_FFD1F730 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC0C:\n"
      "BL      sub_FFD1F7C4 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC14:\n"
      "BL      sub_FFD1F884 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC1C:\n"
      "MOV     R0, #0 \n"
      "BL      sub_FFD1FA7C \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC28:\n"
      "BL      sub_FFD1FBCC \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC30:\n"
      "BL      sub_FFD1FC5C \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC38:\n"
      "BL      sub_FFD1FD1C \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC40:\n"
      "BL      sub_FFC606C8 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC48:\n"
      "BL      sub_FFC6075C \n"
      "BL      sub_FFC276BC \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC54:\n"
      "BL      sub_FFD1F950 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC5C:\n"
      "BL      sub_FFD1F994 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC64:\n"
      "BL      sub_FFC628B0 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC6C:\n"
      "BL      sub_FFC62930 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC74:\n"
      "BL      sub_FFC6298C \n"
      "BL      sub_FFC6294C \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FC80:\n"
      "LDRH    R0, [R4, #0x94] \n"
      "CMP     R0, #4 \n"
      "LDRNEH  R0, [R4] \n"
      "SUBNE   R12, R0, #0x8200 \n"
      "SUBNES  R12, R12, #0x2A \n"
      "BNE     loc_FFC5FCB0 \n"   //loc_ to sub_ ??
      "BL      sub_FFC62930 \n"
      "BL      sub_FFC62D50 \n"
      "B       loc_FFC5FCB0 \n"
"loc_FFC5FCA4:\n"
      "LDR     R1, =0x70B \n"
      "LDR     R0, =0xFFC5F594 \n"
      "BL      sub_FFC0EB14 \n"
"loc_FFC5FCB0:\n"
      "LDR     R0, [SP] \n"
      "LDR     R1, [R0, #4] \n"
      "LDR     R0, [R6] \n"
      "BL      sub_FFC68C20 \n"
      "LDR     R5, [SP] \n"
      "LDR     R0, [R5, #8] \n"
      "CMP     R0, #0 \n"
      "LDREQ   R1, =0x132 \n"
      "LDREQ   R0, =0xFFC5F594 \n"
      "BLEQ    sub_FFC0EB14 \n"
      "STR     R7, [R5, #8] \n"
      "B       loc_FFC5F9F0 \n"
	);
}

//** sub_FFD20314_my  @ 0xFFD20314 

void __attribute__((naked,noinline)) sub_FFD20314_my() {
asm volatile (
      "STMFD   SP!, {R0-R8,LR} \n"
      "MOV     R4, R0 \n"
      "BL      sub_FFD21028 \n"
      "MVN     R1, #0 \n"
      "BL      sub_FFC68C54 \n"
      "LDR     R5, =0x5B08 \n"
      "LDR     R0, [R5, #0xC] \n"
      "CMP     R0, #0 \n"
      "BNE     loc_FFD20364 \n"
      "MOV     R1, #1 \n"
      "MOV     R0, #0 \n"
      "BL      sub_FFC29BB4 \n"
      "STR     R0, [R5, #0xC] \n"
      "MOV     R3, #0 \n"
      "STR     R3, [SP] \n"
      "LDR     R3, =0xFFD1FE0C \n"
      "LDR     R0, =0xFFD2057C \n"
      "MOV     R2, #0x400 \n"
      "MOV     R1, #0x17 \n"
      "BL      sub_FFC29B80 \n"
"loc_FFD20364:\n"
      "MOV     R2, #4 \n"
      "ADD     R1, SP, #8 \n"
      "MOV     R0, #0x8A \n"
      "BL      sub_FFC70BAC \n"
      "TST     R0, #1 \n"
      "MOVNE   R1, #0x3B4 \n"
      "LDRNE   R0, =0xFFD20078 \n"
      "BLNE    sub_FFC0EB14 \n"
      "LDR     R6, =0x34A64 \n"
      "LDR     R7, =0x349A0 \n"
      "LDR     R3, [R6] \n"
      "LDRSH   R2, [R6, #0xC] \n"
      "LDRSH   R1, [R6, #0xE] \n"
      "LDR     R0, [R7, #0x88] \n"
      "BL      sub_FFCEF118 \n"
      "BL      sub_FFC49E68 \n"
      "LDR     R3, =0x5B10 \n"
      "STRH    R0, [R4, #0xA4] \n"
      "SUB     R2, R3, #4 \n"
      "STRD    R2, [SP] \n"
      "MOV     R1, R0 \n"
      "LDRH    R0, [R7, #0x5C] \n"
      "LDRSH   R2, [R6, #0xC] \n"
      "SUB     R3, R3, #8 \n"
      "BL      sub_FFD21694 \n"
      "BL      wait_until_remote_button_is_released\n"
      "BL      capt_seq_hook_set_nr\n"
      "B       sub_FFD203C8\n"  //back to firmware
	);
}

//** sub_FFC5FDC8_my  @ 0xFFC5FDC8 

void __attribute__((naked,noinline)) sub_FFC5FDC8_my() {
asm volatile (
      "STMFD   SP!, {R4-R6,LR} \n"
      "LDR     R4, [R0, #0xC] \n"
      "LDR     R6, =0x349A0 \n"
      "LDR     R0, [R4, #8] \n"
      "MOV     R5, #0 \n"
      "ORR     R0, R0, #1 \n"
      "STR     R0, [R4, #8] \n"
      "LDR     R0, [R6, #0x24] \n"
      "CMP     R0, #0 \n"
      "MOVEQ   R0, #2 \n"
      "BLEQ    sub_FFC5C2E0 \n"
      "BL      sub_FFC602DC \n"
      "LDR     R0, [R6, #0x24] \n"
      "CMP     R0, #0 \n"
      "BNE     loc_FFC5FE64 \n"
      "MOV     R0, R4 \n"
      "BL      sub_FFC6067C \n"
      "MOV     R0, R4 \n"
      "BL      sub_FFD1EF78 \n"
      "CMP     R0, #0 \n"
      "MOV     R0, R4 \n"
      "BEQ     loc_FFC5FE3C \n"
      "BL      sub_FFD1F004 \n"
      "TST     R0, #1 \n"
      "MOVNE   R2, R4 \n"
      "LDMNEFD SP!, {R4-R6,LR} \n"
      "MOVNE   R1, #1 \n"
      "BNE     sub_FFC5DF60 \n"
      "B       loc_FFC5FE40 \n"
"loc_FFC5FE3C:\n"
      "BL      sub_FFD1EFC8 \n"
"loc_FFC5FE40:\n"
      "MOV     R0, R4 \n"
      "BL      sub_FFC5F518 \n"
      "MOV     R0, R4 \n"
      "BL      sub_FFD2024C \n"
      "BL      sub_FFD20E94 \n"
      "MOV     R0, R4 \n"
//      "BL      sub_FFD20314 \n"  //original
     "BL      sub_FFD20314_my \n"  //patched
      "MOV     R5, R0 \n"
      "B       loc_FFC5FE74 \n"
"loc_FFC5FE64:\n"
      "LDR     R0, =0x2850 \n"
      "LDR     R0, [R0, #0x10] \n"
      "CMP     R0, #0 \n"
      "MOVNE   R5, #0x1D \n"
"loc_FFC5FE74:\n"
      "BL      capt_seq_hook_raw_here\n" // ++++->
      "BL      sub_FFC62930 \n"
      "BL      sub_FFC62978 \n"
      "BL      sub_FFC629B8 \n"
      "MOV     R2, R4 \n"
      "MOV     R1, #1 \n"
      "MOV     R0, R5 \n"
      "BL      sub_FFC5DF60 \n"
      "BL      sub_FFD205A4 \n"
      "CMP     R0, #0 \n"
      "LDRNE   R0, [R4, #8] \n"
      "ORRNE   R0, R0, #0x2000 \n"
      "STRNE   R0, [R4, #8] \n"
      "LDMFD   SP!, {R4-R6,PC} \n"
	);
}

//** exp_drv_task  @ 0xFFC99618 

void __attribute__((naked,noinline)) exp_drv_task(  ) { 
asm volatile (
      "STMFD   SP!, {R4-R8,LR} \n"
      "SUB     SP, SP, #0x20 \n"
      "LDR     R8, =0xBB8 \n"
      "LDR     R7, =0x3A74 \n"
      "LDR     R5, =0x3DDB4 \n"
      "MOV     R0, #0 \n"
      "ADD     R6, SP, #0x10 \n"
      "STR     R0, [SP, #0xC] \n"
"loc_FFC99638:\n"
      "LDR     R0, [R7, #0x20] \n"
      "MOV     R2, #0 \n"
      "ADD     R1, SP, #0x1C \n"
      "BL      sub_FFC2936C \n"
      "LDR     R0, [SP, #0xC] \n"
      "CMP     R0, #1 \n"
      "BNE     loc_FFC99684 \n"
      "LDR     R0, [SP, #0x1C] \n"
      "LDR     R0, [R0] \n"
      "CMP     R0, #0x13 \n"
      "CMPNE   R0, #0x14 \n"
      "CMPNE   R0, #0x15 \n"
      "CMPNE   R0, #0x16 \n"
      "BEQ     loc_FFC997E8 \n"
      "CMP     R0, #0x28 \n"
      "BEQ     loc_FFC99770 \n"
      "ADD     R1, SP, #0xC \n"
      "MOV     R0, #0 \n"
      "BL      sub_FFC995C8 \n"
"loc_FFC99684:\n"
      "LDR     R0, [SP, #0x1C] \n"
      "LDR     R1, [R0] \n"
      "CMP     R1, #0x2E \n"
      "BNE     loc_FFC996B4 \n"
      "LDR     R0, [SP, #0x1C] \n"
      "BL      sub_FFC9A920 \n"
      "LDR     R0, [R7, #0x1C] \n"
      "MOV     R1, #1 \n"
      "BL      sub_FFC68C20 \n"
      "BL      sub_FFC0EACC \n"
      "ADD     SP, SP, #0x20 \n"
      "LDMFD   SP!, {R4-R8,PC} \n"
"loc_FFC996B4:\n"
      "CMP     R1, #0x2D \n"
      "BNE     loc_FFC996D0 \n"
      "LDR     R2, [R0, #0x8C]! \n"
      "LDR     R1, [R0, #4] \n"
      "MOV     R0, R1 \n"
      "BLX     R2 \n"
      "B       loc_FFC99C10 \n"
"loc_FFC996D0:\n"
      "CMP     R1, #0x26 \n"
      "BNE     loc_FFC99720 \n"
      "LDR     R0, [R7, #0x1C] \n"
      "MOV     R1, #0x80 \n"
      "BL      sub_FFC68C54 \n"
      "LDR     R0, =0xFFC95D94 \n"
      "MOV     R1, #0x80 \n"
      "BL      sub_FFD14B20 \n"
      "LDR     R0, [R7, #0x1C] \n"
      "MOV     R2, R8 \n"
      "MOV     R1, #0x80 \n"
      "BL      sub_FFC68B60 \n"
      "TST     R0, #1 \n"
      "LDRNE   R1, =0xE5F \n"
      "BNE     loc_FFC997DC \n"
"loc_FFC9970C:\n"
      "LDR     R1, [SP, #0x1C] \n"
      "LDR     R0, [R1, #0x90] \n"
      "LDR     R1, [R1, #0x8C] \n"
      "BLX     R1 \n"
      "B       loc_FFC99C10 \n"
"loc_FFC99720:\n"
      "CMP     R1, #0x27 \n"
      "BNE     loc_FFC99768 \n"
      "ADD     R1, SP, #0xC \n"
      "BL      sub_FFC995C8 \n"
      "LDR     R0, [R7, #0x1C] \n"
      "MOV     R1, #0x100 \n"
      "BL      sub_FFC68C54 \n"
      "LDR     R0, =0xFFC95DA4 \n"
      "MOV     R1, #0x100 \n"
      "BL      sub_FFD14DA8 \n"
      "LDR     R0, [R7, #0x1C] \n"
      "MOV     R2, R8 \n"
      "MOV     R1, #0x100 \n"
      "BL      sub_FFC68B60 \n"
      "TST     R0, #1 \n"
      "BEQ     loc_FFC9970C \n"
      "LDR     R1, =0xE69 \n"
      "B       loc_FFC997DC \n"
"loc_FFC99768:\n"
      "CMP     R1, #0x28 \n"
      "BNE     loc_FFC99780 \n"
"loc_FFC99770:\n"
      "LDR     R0, [SP, #0x1C] \n"
      "ADD     R1, SP, #0xC \n"
      "BL      sub_FFC995C8 \n"
      "B       loc_FFC9970C \n"
"loc_FFC99780:\n"
      "CMP     R1, #0x2B \n"
      "BNE     loc_FFC99798 \n"
      "BL      sub_FFC88DDC \n"
      "BL      sub_FFC89A04 \n"
      "BL      sub_FFC89554 \n"
      "B       loc_FFC9970C \n"
"loc_FFC99798:\n"
      "CMP     R1, #0x2C \n"
      "BNE     loc_FFC997E8 \n"
      "LDR     R0, [R7, #0x1C] \n"
      "MOV     R1, #4 \n"
      "BL      sub_FFC68C54 \n"
      "LDR     R1, =0xFFC95DC4 \n"
      "LDR     R0, =0xFFFFF400 \n"
      "MOV     R2, #4 \n"
      "BL      sub_FFC88858 \n"
      "BL      sub_FFC88AE0 \n"
      "LDR     R0, [R7, #0x1C] \n"
      "MOV     R2, R8 \n"
      "MOV     R1, #4 \n"
      "BL      sub_FFC68A7C \n"
      "TST     R0, #1 \n"
      "BEQ     loc_FFC9970C \n"
      "LDR     R1, =0xE91 \n"
"loc_FFC997DC:\n"
      "LDR     R0, =0xFFC96404 \n"
      "BL      sub_FFC0EB14 \n"
      "B       loc_FFC9970C \n"
"loc_FFC997E8:\n"
      "LDR     R0, [SP, #0x1C] \n"
      "MOV     R4, #1 \n"
      "LDR     R1, [R0] \n"
      "CMP     R1, #0x11 \n"
      "CMPNE   R1, #0x12 \n"
      "BNE     loc_FFC99858 \n"
      "LDR     R1, [R0, #0x7C] \n"
      "ADD     R1, R1, R1, LSL #1 \n"
      "ADD     R1, R0, R1, LSL #2 \n"
      "SUB     R1, R1, #8 \n"
      "LDMIA   R1, {R2-R4} \n"
      "STMIA   R6, {R2-R4} \n"
      "BL      sub_FFC97F54 \n"
      "LDR     R0, [SP, #0x1C] \n"
      "LDR     R1, [R0, #0x7C] \n"
      "LDR     R3, [R0, #0x8C] \n"
      "LDR     R2, [R0, #0x90] \n"
      "ADD     R0, R0, #4 \n"
      "BLX     R3 \n"
      "LDR     R0, [SP, #0x1C] \n"
      "BL      sub_FFC9ACE8 \n"
      "LDR     R0, [SP, #0x1C] \n"
      "LDR     R1, [R0, #0x7C] \n"
      "LDR     R3, [R0, #0x94] \n"
      "LDR     R2, [R0, #0x98] \n"
      "ADD     R0, R0, #4 \n"
      "BLX     R3 \n"
      "B       loc_FFC99B50 \n"
"loc_FFC99858:\n"
      "CMP     R1, #0x13 \n"
      "CMPNE   R1, #0x14 \n"
      "CMPNE   R1, #0x15 \n"
      "CMPNE   R1, #0x16 \n"
      "BNE     loc_FFC99910 \n"
      "ADD     R3, SP, #0xC \n"
      "MOV     R2, SP \n"
      "ADD     R1, SP, #0x10 \n"
      "BL      sub_FFC98230 \n"
      "CMP     R0, #1 \n"
      "MOV     R4, R0 \n"
      "CMPNE   R4, #5 \n"
      "BNE     loc_FFC998AC \n"
      "LDR     R0, [SP, #0x1C] \n"
      "MOV     R2, R4 \n"
      "LDR     R1, [R0, #0x7C]! \n"
      "LDR     R12, [R0, #0x10]! \n"
      "LDR     R3, [R0, #4] \n"
      "MOV     R0, SP \n"
      "BLX     R12 \n"
      "B       loc_FFC998E4 \n"
"loc_FFC998AC:\n"
      "LDR     R0, [SP, #0x1C] \n"
      "CMP     R4, #2 \n"
      "LDR     R3, [R0, #0x90] \n"
      "CMPNE   R4, #6 \n"
      "BNE     loc_FFC998F8 \n"
      "LDR     R12, [R0, #0x8C] \n"
      "MOV     R0, SP \n"
      "MOV     R2, R4 \n"
      "MOV     R1, #1 \n"
      "BLX     R12 \n"
      "LDR     R0, [SP, #0x1C] \n"
      "MOV     R2, SP \n"
      "ADD     R1, SP, #0x10 \n"
      "BL      sub_FFC992D0 \n"
"loc_FFC998E4:\n"
      "LDR     R0, [SP, #0x1C] \n"
      "LDR     R2, [SP, #0xC] \n"
      "MOV     R1, R4 \n"
      "BL      sub_FFC99568 \n"
      "B       loc_FFC99B50 \n"
"loc_FFC998F8:\n"
      "LDR     R1, [R0, #0x7C] \n"
      "LDR     R12, [R0, #0x8C] \n"
      "ADD     R0, R0, #4 \n"
      "MOV     R2, R4 \n"
      "BLX     R12 \n"
      "B       loc_FFC99B50 \n"
"loc_FFC99910:\n"
      "CMP     R1, #0x22 \n"
      "CMPNE   R1, #0x23 \n"
      "BNE     loc_FFC9995C \n"
      "LDR     R1, [R0, #0x7C] \n"
      "ADD     R1, R1, R1, LSL #1 \n"
      "ADD     R1, R0, R1, LSL #2 \n"
      "SUB     R1, R1, #8 \n"
      "LDMIA   R1, {R2-R4} \n"
      "STMIA   R6, {R2-R4} \n"
      "BL      sub_FFC974A4 \n"
      "LDR     R0, [SP, #0x1C] \n"
      "LDR     R1, [R0, #0x7C] \n"
      "LDR     R3, [R0, #0x8C] \n"
      "LDR     R2, [R0, #0x90] \n"
      "ADD     R0, R0, #4 \n"
      "BLX     R3 \n"
      "LDR     R0, [SP, #0x1C] \n"
      "BL      sub_FFC97798 \n"
      "B       loc_FFC99B50 \n"
"loc_FFC9995C:\n"
      "ADD     R1, R0, #4 \n"
      "LDMIA   R1, {R2,R3,R12} \n"
      "STMIA   R6, {R2,R3,R12} \n"
      "LDR     R1, [R0] \n"
      "CMP     R1, #0x25 \n"
      "ADDLS   PC, PC, R1, LSL #2 \n"
      "B       loc_FFC99B30 \n"
      "B       loc_FFC99A10 \n"
      "B       loc_FFC99A10 \n"
      "B       loc_FFC99A18 \n"
      "B       loc_FFC99A20 \n"
      "B       loc_FFC99A20 \n"
      "B       loc_FFC99A20 \n"
      "B       loc_FFC99A10 \n"
      "B       loc_FFC99A18 \n"
      "B       loc_FFC99A20 \n"
      "B       loc_FFC99A20 \n"
      "B       loc_FFC99A38 \n"
      "B       loc_FFC99A38 \n"
      "B       loc_FFC99B24 \n"
      "B       loc_FFC99B2C \n"
      "B       loc_FFC99B2C \n"
      "B       loc_FFC99B2C \n"
      "B       loc_FFC99B2C \n"
      "B       loc_FFC99B30 \n"
      "B       loc_FFC99B30 \n"
      "B       loc_FFC99B30 \n"
      "B       loc_FFC99B30 \n"
      "B       loc_FFC99B30 \n"
      "B       loc_FFC99B30 \n"
      "B       loc_FFC99A28 \n"
      "B       loc_FFC99A30 \n"
      "B       loc_FFC99A30 \n"
      "B       loc_FFC99A44 \n"
      "B       loc_FFC99A44 \n"
      "B       loc_FFC99A4C \n"
      "B       loc_FFC99A7C \n"
      "B       loc_FFC99AAC \n"
      "B       loc_FFC99ADC \n"
      "B       loc_FFC99B0C \n"
      "B       loc_FFC99B0C \n"
      "B       loc_FFC99B30 \n"
      "B       loc_FFC99B30 \n"
      "B       loc_FFC99B14 \n"
      "B       loc_FFC99B1C \n"
"loc_FFC99A10:\n"
      "BL      sub_FFC962AC \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99A18:\n"
      "BL      sub_FFC96530 \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99A20:\n"
      "BL      sub_FFC96738 \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99A28:\n"
      "BL      sub_FFC969B0 \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99A30:\n"
      "BL      sub_FFC96BA8 \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99A38:\n"
//      "BL      sub_FFC96E64 \n"  //original
      "BL      sub_FFC96E64_my\n"  //patched
      "MOV     R4, #0 \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99A44:\n"
      "BL      sub_FFC96FA4 \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99A4C:\n"
      "LDRH    R1, [R0, #4] \n"
      "STRH    R1, [SP, #0x10] \n"
      "LDRH    R1, [R5, #2] \n"
      "STRH    R1, [SP, #0x12] \n"
      "LDRH    R1, [R5, #4] \n"
      "STRH    R1, [SP, #0x14] \n"
      "LDRH    R1, [R5, #6] \n"
      "STRH    R1, [SP, #0x16] \n"
      "LDRH    R1, [R0, #0xC] \n"
      "STRH    R1, [SP, #0x18] \n"
      "BL      sub_FFC9A994 \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99A7C:\n"
      "LDRH    R1, [R0, #4] \n"
      "STRH    R1, [SP, #0x10] \n"
      "LDRH    R1, [R5, #2] \n"
      "STRH    R1, [SP, #0x12] \n"
      "LDRH    R1, [R5, #4] \n"
      "STRH    R1, [SP, #0x14] \n"
      "LDRH    R1, [R5, #6] \n"
      "STRH    R1, [SP, #0x16] \n"
      "LDRH    R1, [R5, #8] \n"
      "STRH    R1, [SP, #0x18] \n"
      "BL      sub_FFC9AB00 \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99AAC:\n"
      "LDRH    R1, [R5] \n"
      "STRH    R1, [SP, #0x10] \n"
      "LDRH    R1, [R0, #6] \n"
      "STRH    R1, [SP, #0x12] \n"
      "LDRH    R1, [R5, #4] \n"
      "STRH    R1, [SP, #0x14] \n"
      "LDRH    R1, [R5, #6] \n"
      "STRH    R1, [SP, #0x16] \n"
      "LDRH    R1, [R5, #8] \n"
      "STRH    R1, [SP, #0x18] \n"
      "BL      sub_FFC9ABAC \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99ADC:\n"
      "LDRH    R1, [R5] \n"
      "STRH    R1, [SP, #0x10] \n"
      "LDRH    R1, [R5, #2] \n"
      "STRH    R1, [SP, #0x12] \n"
      "LDRH    R1, [R5, #4] \n"
      "STRH    R1, [SP, #0x14] \n"
      "LDRH    R1, [R5, #6] \n"
      "STRH    R1, [SP, #0x16] \n"
      "LDRH    R1, [R0, #0xC] \n"
      "STRH    R1, [SP, #0x18] \n"
      "BL      sub_FFC9AC4C \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99B0C:\n"
      "BL      sub_FFC972FC \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99B14:\n"
      "BL      sub_FFC9789C \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99B1C:\n"
      "BL      sub_FFC97AD8 \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99B24:\n"
      "BL      sub_FFC97C54 \n"
      "B       loc_FFC99B30 \n"
"loc_FFC99B2C:\n"
      "BL      sub_FFC97DF0 \n"
"loc_FFC99B30:\n"
      "LDR     R0, [SP, #0x1C] \n"
      "LDR     R1, [R0, #0x7C] \n"
      "LDR     R3, [R0, #0x8C] \n"
      "LDR     R2, [R0, #0x90] \n"
      "ADD     R0, R0, #4 \n"
      "BLX     R3 \n"
      "CMP     R4, #1 \n"
      "BNE     loc_FFC99B98 \n"
"loc_FFC99B50:\n"
      "LDR     R0, [SP, #0x1C] \n"
      "MOV     R2, #0xC \n"
      "LDR     R1, [R0, #0x7C] \n"
      "ADD     R1, R1, R1, LSL #1 \n"
      "ADD     R0, R0, R1, LSL #2 \n"
      "SUB     R4, R0, #8 \n"
      "LDR     R0, =0x3DDB4 \n"
      "ADD     R1, SP, #0x10 \n"
      "BL      sub_FFEA2D44 \n"
      "LDR     R0, =0x3DDC0 \n"
      "MOV     R2, #0xC \n"
      "ADD     R1, SP, #0x10 \n"
      "BL      sub_FFEA2D44 \n"
      "LDR     R0, =0x3DDCC \n"
      "MOV     R2, #0xC \n"
      "MOV     R1, R4 \n"
      "BL      sub_FFEA2D44 \n"
      "B       loc_FFC99C10 \n"
"loc_FFC99B98:\n"
      "LDR     R0, [SP, #0x1C] \n"
      "LDR     R0, [R0] \n"
      "CMP     R0, #0xB \n"
      "BNE     loc_FFC99BE0 \n"
      "MOV     R3, #0 \n"
      "STR     R3, [SP] \n"
      "MOV     R3, #1 \n"
      "MOV     R2, #1 \n"
      "MOV     R1, #1 \n"
      "MOV     R0, #0 \n"
      "BL      sub_FFC960B4 \n"
      "MOV     R3, #0 \n"
      "STR     R3, [SP] \n"
      "MOV     R3, #1 \n"
      "MOV     R2, #1 \n"
      "MOV     R1, #1 \n"
      "MOV     R0, #0 \n"
      "B       loc_FFC99C0C \n"
"loc_FFC99BE0:\n"
      "MOV     R3, #1 \n"
      "MOV     R2, #1 \n"
      "MOV     R1, #1 \n"
      "MOV     R0, #1 \n"
      "STR     R3, [SP] \n"
      "BL      sub_FFC960B4 \n"
      "MOV     R3, #1 \n"
      "MOV     R2, #1 \n"
      "MOV     R1, #1 \n"
      "MOV     R0, #1 \n"
      "STR     R3, [SP] \n"
"loc_FFC99C0C:\n"
      "BL      sub_FFC961F4 \n"
"loc_FFC99C10:\n"
      "LDR     R0, [SP, #0x1C] \n"
      "BL      sub_FFC9A920 \n"
      "B       loc_FFC99638 \n"
	);
}

//** sub_FFC96E64_my  @ 0xFFC96E64 

void __attribute__((naked,noinline)) sub_FFC96E64_my() {
asm volatile (
      "STMFD   SP!, {R4-R8,LR} \n"
      "LDR     R7, =0x3A74 \n"
      "MOV     R4, R0 \n"
      "LDR     R0, [R7, #0x1C] \n"
      "MOV     R1, #0x3E \n"
      "BL      sub_FFC68C54 \n"
      "LDRSH   R0, [R4, #4] \n"
      "MOV     R2, #0 \n"
      "MOV     R1, #0 \n"
      "BL      sub_FFC95E18 \n"
      "MOV     R6, R0 \n"
      "LDRSH   R0, [R4, #6] \n"
      "BL      sub_FFC95F28 \n"
      "LDRSH   R0, [R4, #8] \n"
      "BL      sub_FFC95F80 \n"
      "LDRSH   R0, [R4, #0xA] \n"
      "BL      sub_FFC95FD8 \n"
      "LDRSH   R0, [R4, #0xC] \n"
      "MOV     R1, #0 \n"
      "BL      sub_FFC96030 \n"
      "MOV     R5, R0 \n"
      "LDR     R0, [R4] \n"
      "LDR     R8, =0x3DDCC \n"
      "CMP     R0, #0xB \n"
      "MOVEQ   R6, #0 \n"
      "MOVEQ   R5, #0 \n"
      "BEQ     loc_FFC96EF8 \n"
      "CMP     R6, #1 \n"
      "BNE     loc_FFC96EF8 \n"
      "LDRSH   R0, [R4, #4] \n"
      "LDR     R1, =0xFFC95D84 \n"
      "MOV     R2, #2 \n"
      "BL      sub_FFD14C74 \n"
      "STRH    R0, [R4, #4] \n"
      "MOV     R0, #0 \n"
      "STR     R0, [R7, #0x28] \n"
      "B       loc_FFC96F00 \n"
"loc_FFC96EF8:\n"
      "LDRH    R0, [R8] \n"
      "STRH    R0, [R4, #4] \n"
"loc_FFC96F00:\n"
      "CMP     R5, #1 \n"
      "LDRNEH  R0, [R8, #8] \n"
      "BNE     loc_FFC96F1C \n"
      "LDRSH   R0, [R4, #0xC] \n"
      "LDR     R1, =0xFFC95E08 \n"
      "MOV     R2, #0x20 \n"
      "BL      sub_FFC9A950 \n"
"loc_FFC96F1C:\n"
      "STRH    R0, [R4, #0xC] \n"
      "LDRSH   R0, [R4, #6] \n"
//      "BL      sub_FFC88B4C \n"    //original
      "BL      sub_FFC88B4C_my\n"    //patched
      "LDRSH   R0, [R4, #8] \n"
      "MOV     R1, #1 \n"
      "BL      sub_FFC8929C \n"
      "MOV     R1, #0 \n"
      "ADD     R0, R4, #8 \n"
      "BL      sub_FFC89324 \n"
      "LDRSH   R0, [R4, #0xE] \n"
      "BL      sub_FFC91178 \n"
      "LDR     R4, =0xBB8 \n"
      "CMP     R6, #1 \n"
      "BNE     loc_FFC96F74 \n"
      "LDR     R0, [R7, #0x1C] \n"
      "MOV     R2, R4 \n"
      "MOV     R1, #2 \n"
      "BL      sub_FFC68B60 \n"
      "TST     R0, #1 \n"
      "LDRNE   R1, =0x5A3 \n"
      "LDRNE   R0, =0xFFC96404 \n"
      "BLNE    sub_FFC0EB14 \n"
"loc_FFC96F74:\n"
      "CMP     R5, #1 \n"
      "LDMNEFD SP!, {R4-R8,PC} \n"
      "LDR     R0, [R7, #0x1C] \n"
      "MOV     R2, R4 \n"
      "MOV     R1, #0x20 \n"
      "BL      sub_FFC68B60 \n"
      "TST     R0, #1 \n"
      "LDRNE   R1, =0x5A8 \n"
      "LDRNE   R0, =0xFFC96404 \n"
      "LDMNEFD SP!, {R4-R8,LR} \n"
      "BNE     sub_FFC0EB14 \n"
      "LDMFD   SP!, {R4-R8,PC} \n"
	);
}

//** sub_FFC88B4C_my  @ 0xFFC88B4C 

void __attribute__((naked,noinline)) sub_FFC88B4C_my() {
asm volatile (
      "STMFD   SP!, {R4-R6,LR} \n"
      "LDR     R5, =0x3760 \n"
      "MOV     R4, R0 \n"
      "LDR     R0, [R5, #4] \n"
      "CMP     R0, #1 \n"
      "LDRNE   R1, =0x146 \n"
      "LDRNE   R0, =0xFFC88950 \n"
      "BLNE    sub_FFC0EB14 \n"
      "CMN     R4, #0xC00 \n"
      "LDREQSH R4, [R5, #2] \n"
      "CMN     R4, #0xC00 \n"
      "MOVEQ   R1, #0x14C \n"
      "LDREQ   R0, =0xFFC88950 \n"
      "STRH    R4, [R5, #2] \n"
      "BLEQ    sub_FFC0EB14 \n"
      "MOV     R0, R4 \n"
//      "BL      sub_FFD8F408 \n"  //original _apex2us
      "BL      apex2us\n"  // +
      "MOV     R4, R0 \n"
      "BL      sub_FFCBB7D4 \n"
      "MOV     R0, R4 \n"
      "BL      sub_FFCBF630 \n"
      "TST     R0, #1 \n"
      "LDRNE   R1, =0x151 \n"
      "LDMNEFD SP!, {R4-R6,LR} \n"
      "LDRNE   R0, =0xFFC88950 \n"
      "BNE     sub_FFC0EB14 \n"
      "LDMFD   SP!, {R4-R6,PC} \n"
	);
}
