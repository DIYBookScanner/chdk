#include "lolevel.h"
#include "platform.h"
#include "core.h"

static long *nrflag = (long*)(0x718C+0x8);  // elph100 FF989D4C + 8
#define NR_AUTO (0)							// have to explictly reset value back to 0 to enable auto
#define PAUSE_FOR_FILE_COUNTER 200          // Enable delay in capt_seq_hook_raw_here to ensure file counter is updated

#include "../../../generic/capt_seq.c"

//** capt_seq_task  @ 0xFF881368

void __attribute__((naked,noinline)) capt_seq_task(  ) {

asm volatile (

"	STMFD	SP!, {R3-R9,LR} \n"
"	LDR	R5, =0x3D184 \n"
"	LDR	R7, =0x2DD0 \n"
"	MOV	R6, #0 \n"

"loc_FF881378:\n"
"	LDR	R0, [R7, #4] \n"
"	MOV	R2, #0 \n"
"	MOV	R1, SP \n"
"	BL	sub_FF83B068 \n"
"	TST	R0, #1 \n"
"	BEQ	loc_FF8813A4 \n"
"	LDR	R1, =0x47A \n"
"	LDR	R0, =0xFF880E90 \n"
"	BL	sub_FF81EC88 \n"
"	BL	sub_FF81EC40 \n"
"	LDMFD	SP!, {R3-R9,PC} \n"

"loc_FF8813A4:\n"
"	LDR	R0, [SP] \n"
"	LDR	R1, [R0] \n"
"	CMP	R1, #0x23 \n"
"	ADDCC	PC, PC, R1, LSL #2 \n"
"	B	loc_FF8815F4 \n"
"	B	loc_FF881444 \n"
"	B	loc_FF88145C \n"
"	B	loc_FF881494 \n"
"	B	loc_FF8814A8 \n"
"	B	loc_FF8814A0 \n"
"	B	loc_FF8814B4 \n"
"	B	loc_FF8814BC \n"
"	B	loc_FF8814C4 \n"
"	B	loc_FF8814E0 \n"
"	B	loc_FF881520 \n"
"	B	loc_FF8814EC \n"
"	B	loc_FF8814F8 \n"
"	B	loc_FF881500 \n"
"	B	loc_FF881508 \n"
"	B	loc_FF881510 \n"
"	B	loc_FF881518 \n"
"	B	loc_FF881528 \n"
"	B	loc_FF881530 \n"
"	B	loc_FF881538 \n"
"	B	loc_FF881540 \n"
"	B	loc_FF881548 \n"
"	B	loc_FF881554 \n"
"	B	loc_FF88155C \n"
"	B	loc_FF881564 \n"
"	B	loc_FF88156C \n"
"	B	loc_FF881574 \n"
"	B	loc_FF881580 \n"
"	B	loc_FF881588 \n"
"	B	loc_FF881590 \n"
"	B	loc_FF881598 \n"
"	B	loc_FF8815A0 \n"
"	B	loc_FF8815A8 \n"
"	B	loc_FF8815B0 \n"
"	B	loc_FF8815BC \n"
"	B	loc_FF881600 \n"

"loc_FF881444:\n"
"	BL      shooting_expo_iso_override\n"		// added
"	BL	sub_FF881BF0 \n"
"	BL      shooting_expo_param_override\n"		// added

"	BL	sub_FF87EAF0 \n"

"	MOV     R0, #0\n"				// added
"	STR     R0, [R5,#0x28]\n"			// added, fixes overrides  behavior at short shutter p

//"	LDR	R0, [R5, #0x28] \n"

//"	CMP	R0, #0 \n"
//"	BLNE	sub_FF987378 \n"

"	B	loc_FF881600 \n"

"loc_FF88145C:\n"

"       BL      wait_until_remote_button_is_released\n" // +++
"       BL      capt_seq_hook_set_nr\n"                         // +++


"	LDR	R8, [R0, #0xC] \n"
"	MOV	R0, R8 \n"
"	BL	sub_FF987208 \n"

"       BL      capt_seq_hook_raw_here\n"           // added

"	MOV	R4, R0 \n"
"	MOV	R2, R8 \n"
"	MOV	R1, #1 \n"
"	BL	sub_FF87F4E0 \n"
"	TST	R4, #1 \n"
"	BNE	loc_FF88148C \n"
"	MOV	R0, R8 \n"
"	BL	sub_FF986C20 \n"
"	B	loc_FF881600 \n"
"loc_FF88148C:\n"
"	BL	sub_FF986BF0 \n"
"	B	loc_FF881600 \n"
"loc_FF881494:\n"
"	MOV	R0, #1 \n"
"	BL	sub_FF881ED0 \n"
"	B	loc_FF881600 \n"
"loc_FF8814A0:\n"
"	BL	sub_FF88182C \n"
"	B	loc_FF8814AC \n"
"loc_FF8814A8:\n"
"	BL	sub_FF881BD0 \n"
"loc_FF8814AC:\n"
"	STR	R6, [R5, #0x28] \n"
"	B	loc_FF881600 \n"
"loc_FF8814B4:\n"
"	BL	sub_FF881BD8 \n"
"	B	loc_FF881600 \n"
"loc_FF8814BC:\n"
"	BL	sub_FF881DC4 \n"
"	B	loc_FF8814E4 \n"
"loc_FF8814C4:\n"
"	LDR	R4, [R0, #0xC] \n"
"	MOV	R0, R4 \n"
"	BL	sub_FF9873CC \n"
"	MOV	R2, R4 \n"
"	MOV	R1, #9 \n"
"	BL	sub_FF87F4E0 \n"
"	B	loc_FF881600 \n"
"loc_FF8814E0:\n"
"	BL	sub_FF881E38 \n"
"loc_FF8814E4:\n"
"	BL	sub_FF87EAF0 \n"
"	B	loc_FF881600 \n"
"loc_FF8814EC:\n"
"	LDR	R0, [R5, #0x58] \n"
"	BL	sub_FF8825C4 \n"
"	B	loc_FF881600 \n"
"loc_FF8814F8:\n"
"	BL	sub_FF882898 \n"
"	B	loc_FF881600 \n"
"loc_FF881500:\n"
"	BL	sub_FF8828FC \n"
"	B	loc_FF881600 \n"
"loc_FF881508:\n"
"	BL	sub_FF882AF8 \n"
"	B	loc_FF881600 \n"
"loc_FF881510:\n"
"	BL	sub_FF882F48 \n"
"	B	loc_FF881600 \n"
"loc_FF881518:\n"
"	BL	sub_FF882FF8 \n"
"	B	loc_FF881600 \n"
"loc_FF881520:\n"
"	BL	sub_FF881BD0 \n"
"	B	loc_FF881600 \n"
"loc_FF881528:\n"
"	BL	sub_FF985EBC \n"
"	B	loc_FF881600 \n"
"loc_FF881530:\n"
"	BL	sub_FF9860D0 \n"
"	B	loc_FF881600 \n"
"loc_FF881538:\n"
"	BL	sub_FF986174 \n"
"	B	loc_FF881600 \n"
"loc_FF881540:\n"
"	BL	sub_FF986244 \n"
"	B	loc_FF881600 \n"
"loc_FF881548:\n"
"	MOV	R0, #0 \n"
"	BL	sub_FF9864B4 \n"
"	B	loc_FF881600 \n"
"loc_FF881554:\n"
"	BL	sub_FF98661C \n"
"	B	loc_FF881600 \n"
"loc_FF88155C:\n"
"	BL	sub_FF9866B4 \n"
"	B	loc_FF881600 \n"
"loc_FF881564:\n"
"	BL	sub_FF986794 \n"
"	B	loc_FF881600 \n"
"loc_FF88156C:\n"
"	BL	sub_FF88209C \n"
"	B	loc_FF881600 \n"
"loc_FF881574:\n"
"	BL	sub_FF8820DC \n"
"	BL	sub_FF838C90 \n"
"	B	loc_FF881600 \n"
"loc_FF881580:\n"
"	BL	sub_FF986310 \n"
"	B	loc_FF881600 \n"
"loc_FF881588:\n"
"	BL	sub_FF986378 \n"
"	B	loc_FF881600 \n"
"loc_FF881590:\n"
"	BL	sub_FF885450 \n"
"	B	loc_FF881600 \n"
"loc_FF881598:\n"
"	BL	sub_FF8854D4 \n"
"	B	loc_FF881600 \n"
"loc_FF8815A0:\n"
"	BL	sub_FF9868CC \n"
"	B	loc_FF881600 \n"
"loc_FF8815A8:\n"
"	BL	sub_FF986930 \n"
"	B	loc_FF881600 \n"
"loc_FF8815B0:\n"
"	BL	sub_FF885530 \n"
"	BL	sub_FF8854F0 \n"
"	B	loc_FF881600 \n"
"loc_FF8815BC:\n"
"	MOV	R0, #1 \n"
"	BL	sub_FF987BC0 \n"
"	MOV	R0, #1 \n"
"	BL	sub_FF987CF4 \n"
"	LDRH	R0, [R5, #0x98] \n"
"	CMP	R0, #4 \n"
"	LDRNEH	R0, [R5] \n"
"	SUBNE	R1, R0, #0x8200 \n"
"	SUBNES	R1, R1, #0x2A \n"
"	BNE	loc_FF881600 \n"
"	BL	sub_FF8854D4 \n"
"	BL	sub_FF885AFC \n"
"	BL	sub_FF885954 \n"
"	B	loc_FF881600 \n"
"loc_FF8815F4:\n"
"	LDR	R1, =0x5DB \n"
"	LDR	R0, =0xFF880E90 \n"
"	BL	sub_FF81EC88 \n"
"loc_FF881600:\n"
"	LDR	R0, [SP] \n"
"	LDR	R1, [R0, #4] \n"
"	LDR	R0, [R7] \n"
"	BL	sub_FF88C62C \n"
"	LDR	R4, [SP] \n"
"	LDR	R0, [R4, #8] \n"
"	CMP	R0, #0 \n"
"	LDREQ	R0, =0xFF880E90 \n"
"	MOVEQ	R1, #0x118 \n"
"	BLEQ	sub_FF81EC88 \n"
"	STR	R6, [R4, #8] \n"
"	B	loc_FF881378 \n"
	);
}


//** exp_drv_task  @ 0xFF8CA428

void __attribute__((naked,noinline)) exp_drv_task(  ) {
asm volatile (
"	STMFD	SP!, {R4-R9,LR} \n"
"	SUB	SP, SP, #0x24 \n"
"	LDR	R6, =0x4288 \n"
"	LDR	R7, =0xBB8 \n"
"	LDR	R4, =0x5874C \n"
"	MOV	R0, #0 \n"
"	ADD	R5, SP, #0x14 \n"
"	STR	R0, [SP, #0x10] \n"
"loc_FF8CA448:\n"
"	LDR	R0, [R6, #0x20] \n"
"	MOV	R2, #0 \n"
"	ADD	R1, SP, #0x20 \n"
"	BL	sub_FF83B068 \n"
"	LDR	R0, [SP, #0x10] \n"
"	CMP	R0, #1 \n"
"	BNE	loc_FF8CA494 \n"
"	LDR	R0, [SP, #0x20] \n"
"	LDR	R0, [R0] \n"
"	CMP	R0, #0x14 \n"
"	CMPNE	R0, #0x15 \n"
"	CMPNE	R0, #0x16 \n"
"	CMPNE	R0, #0x17 \n"
"	BEQ	loc_FF8CA5F4 \n"
"	CMP	R0, #0x29 \n"
"	BEQ	loc_FF8CA57C \n"
"	ADD	R1, SP, #0x10 \n"
"	MOV	R0, #0 \n"
"	BL	sub_FF8CA3D8 \n"
"loc_FF8CA494:\n"
"	LDR	R0, [SP, #0x20] \n"
"	LDR	R1, [R0] \n"
"	CMP	R1, #0x2F \n"
"	BNE	loc_FF8CA4C0 \n"
"	BL	sub_FF8CB850 \n"
"	LDR	R0, [R6, #0x1C] \n"
"	MOV	R1, #1 \n"
"	BL	sub_FF88C62C \n"
"	BL	sub_FF81EC40 \n"
"	ADD	SP, SP, #0x24 \n"
"	LDMFD	SP!, {R4-R9,PC} \n"
"loc_FF8CA4C0:\n"
"	CMP	R1, #0x2E \n"
"	BNE	loc_FF8CA4DC \n"
"	LDR	R2, [R0, #0x8C]! \n"
"	LDR	R1, [R0, #4] \n"
"	MOV	R0, R1 \n"
"	BLX	R2 \n"
"	B	loc_FF8CAA84 \n"
"loc_FF8CA4DC:\n"
"	CMP	R1, #0x27 \n"
"	BNE	loc_FF8CA52C \n"
"	LDR	R0, [R6, #0x1C] \n"
"	MOV	R1, #0x80 \n"
"	BL	sub_FF88C660 \n"
"	LDR	R0, =0xFF8C56AC \n"
"	MOV	R1, #0x80 \n"
"	BL	sub_FF978D20 \n"
"	LDR	R0, [R6, #0x1C] \n"
"	MOV	R2, R7 \n"
"	MOV	R1, #0x80 \n"
"	BL	sub_FF88C56C \n"
"	TST	R0, #1 \n"
"	LDRNE	R1, =0x1708 \n"
"	BNE	loc_FF8CA5E8 \n"
"loc_FF8CA518:\n"
"	LDR	R1, [SP, #0x20] \n"
"	LDR	R0, [R1, #0x90] \n"
"	LDR	R1, [R1, #0x8C] \n"
"	BLX	R1 \n"
"	B	loc_FF8CAA84 \n"
"loc_FF8CA52C:\n"
"	CMP	R1, #0x28 \n"
"	BNE	loc_FF8CA574 \n"
"	ADD	R1, SP, #0x10 \n"
"	BL	sub_FF8CA3D8 \n"
"	LDR	R0, [R6, #0x1C] \n"
"	MOV	R1, #0x100 \n"
"	BL	sub_FF88C660 \n"
"	LDR	R0, =0xFF8C56BC \n"
"	MOV	R1, #0x100 \n"
"	BL	sub_FF978FB0 \n"
"	LDR	R0, [R6, #0x1C] \n"
"	MOV	R2, R7 \n"
"	MOV	R1, #0x100 \n"
"	BL	sub_FF88C56C \n"
"	TST	R0, #1 \n"
"	BEQ	loc_FF8CA518 \n"
"	LDR	R1, =0x1712 \n"
"	B	loc_FF8CA5E8 \n"
"loc_FF8CA574:\n"
"	CMP	R1, #0x29 \n"
"	BNE	loc_FF8CA58C \n"
"loc_FF8CA57C:\n"
"	LDR	R0, [SP, #0x20] \n"
"	ADD	R1, SP, #0x10 \n"
"	BL	sub_FF8CA3D8 \n"
"	B	loc_FF8CA518 \n"
"loc_FF8CA58C:\n"
"	CMP	R1, #0x2C \n"
"	BNE	loc_FF8CA5A4 \n"
"	BL	sub_FF8B70BC \n"
"	BL	sub_FF8B7D2C \n"
"	BL	sub_FF8B78A4 \n"
"	B	loc_FF8CA518 \n"
"loc_FF8CA5A4:\n"
"	CMP	R1, #0x2D \n"
"	BNE	loc_FF8CA5F4 \n"
"	LDR	R0, [R6, #0x1C] \n"
"	MOV	R1, #4 \n"
"	BL	sub_FF88C660 \n"
"	LDR	R1, =0xFF8C56DC \n"
"	LDR	R0, =0xFFFFF400 \n"
"	MOV	R2, #4 \n"
"	BL	sub_FF8B6B30 \n"
"	BL	sub_FF8B6DC0 \n"
"	LDR	R0, [R6, #0x1C] \n"
"	MOV	R2, R7 \n"
"	MOV	R1, #4 \n"
"	BL	sub_FF88C488 \n"
"	TST	R0, #1 \n"
"	BEQ	loc_FF8CA518 \n"
"	LDR	R1, =0x173A \n"
"loc_FF8CA5E8:\n"
"	LDR	R0, =0xFF8C5E84 \n"
"	BL	sub_FF81EC88 \n"
"	B	loc_FF8CA518 \n"
"loc_FF8CA5F4:\n"
"	LDR	R0, [SP, #0x20] \n"
"	MOV	R8, #1 \n"
"	LDR	R1, [R0] \n"
"	CMP	R1, #0x12 \n"
"	CMPNE	R1, #0x13 \n"
"	BNE	loc_FF8CA65C \n"
"	LDR	R1, [R0, #0x7C] \n"
"	ADD	R1, R1, R1, LSL #1 \n"
"	ADD	R1, R0, R1, LSL #2 \n"
"	SUB	R1, R1, #8 \n"
"	LDMIA	R1, {R2,R3,R9} \n"
"	STMIA	R5, {R2,R3,R9} \n"
"	BL	sub_FF8C8694 \n"
"	LDR	R0, [SP, #0x20] \n"
"	LDR	R1, [R0, #0x7C] \n"
"	LDR	R3, [R0, #0x8C] \n"
"	LDR	R2, [R0, #0x90] \n"
"	ADD	R0, R0, #4 \n"
"	BLX	R3 \n"
"	LDR	R0, [SP, #0x20] \n"
"	BL	sub_FF8CBC64 \n"
"	LDR	R0, [SP, #0x20] \n"
"	LDR	R1, [R0, #0x7C] \n"
"	LDR	R2, [R0, #0x98] \n"
"	LDR	R3, [R0, #0x94] \n"
"	B	loc_FF8CA970 \n"
"loc_FF8CA65C:\n"
"	CMP	R1, #0x14 \n"
"	CMPNE	R1, #0x15 \n"
"	CMPNE	R1, #0x16 \n"
"	CMPNE	R1, #0x17 \n"
"	BNE	loc_FF8CA714 \n"
"	ADD	R3, SP, #0x10 \n"
"	ADD	R2, SP, #4 \n"
"	ADD	R1, SP, #0x14 \n"
"	BL	sub_FF8C88FC \n"
"	CMP	R0, #1 \n"
"	MOV	R9, R0 \n"
"	CMPNE	R9, #5 \n"
"	BNE	loc_FF8CA6B0 \n"
"	LDR	R0, [SP, #0x20] \n"
"	MOV	R2, R9 \n"
"	LDR	R1, [R0, #0x7C]! \n"
"	LDR	R12, [R0, #0x10]! \n"
"	LDR	R3, [R0, #4] \n"
"	ADD	R0, SP, #4 \n"
"	BLX	R12 \n"
"	B	loc_FF8CA6E8 \n"
"loc_FF8CA6B0:\n"
"	LDR	R0, [SP, #0x20] \n"
"	CMP	R9, #2 \n"
"	LDR	R3, [R0, #0x90] \n"
"	CMPNE	R9, #6 \n"
"	BNE	loc_FF8CA6FC \n"
"	LDR	R12, [R0, #0x8C] \n"
"	MOV	R2, R9 \n"
"	MOV	R1, #1 \n"
"	ADD	R0, SP, #4 \n"
"	BLX	R12 \n"
"	LDR	R0, [SP, #0x20] \n"
"	ADD	R2, SP, #4 \n"
"	ADD	R1, SP, #0x14 \n"
"	BL	sub_FF8CA0C8 \n"
"loc_FF8CA6E8:\n"
"	LDR	R0, [SP, #0x20] \n"
"	LDR	R2, [SP, #0x10] \n"
"	MOV	R1, R9 \n"
"	BL	sub_FF8CA378 \n"
"	B	loc_FF8CA978 \n"
"loc_FF8CA6FC:\n"
"	LDR	R1, [R0, #0x7C] \n"
"	LDR	R12, [R0, #0x8C] \n"
"	MOV	R2, R9 \n"
"	ADD	R0, R0, #4 \n"
"	BLX	R12 \n"
"	B	loc_FF8CA978 \n"
"loc_FF8CA714:\n"
"	CMP	R1, #0x23 \n"
"	CMPNE	R1, #0x24 \n"
"	BNE	loc_FF8CA760 \n"
"	LDR	R1, [R0, #0x7C] \n"
"	ADD	R1, R1, R1, LSL #1 \n"
"	ADD	R1, R0, R1, LSL #2 \n"
"	SUB	R1, R1, #8 \n"
"	LDMIA	R1, {R2,R3,R9} \n"
"	STMIA	R5, {R2,R3,R9} \n"
"	BL	sub_FF8C7484 \n"
"	LDR	R0, [SP, #0x20] \n"
"	LDR	R1, [R0, #0x7C] \n"
"	LDR	R3, [R0, #0x8C] \n"
"	LDR	R2, [R0, #0x90] \n"
"	ADD	R0, R0, #4 \n"
"	BLX	R3 \n"
"	LDR	R0, [SP, #0x20] \n"
"	BL	sub_FF8C7958 \n"
"	B	loc_FF8CA978 \n"
"loc_FF8CA760:\n"
"	ADD	R1, R0, #4 \n"
"	LDMIA	R1, {R2,R3,R9} \n"
"	STMIA	R5, {R2,R3,R9} \n"
"	LDR	R1, [R0] \n"
"	CMP	R1, #0x27 \n"
"	ADDCC	PC, PC, R1, LSL #2 \n"
"	B	loc_FF8CA960 \n"
"	B	loc_FF8CA818 \n"
"	B	loc_FF8CA818 \n"
"	B	loc_FF8CA820 \n"
"	B	loc_FF8CA828 \n"
"	B	loc_FF8CA828 \n"
"	B	loc_FF8CA828 \n"
"	B	loc_FF8CA818 \n"
"	B	loc_FF8CA820 \n"
"	B	loc_FF8CA828 \n"
"	B	loc_FF8CA828 \n"
"	B	loc_FF8CA840 \n"
"	B	loc_FF8CA840 \n"
"	B	loc_FF8CA94C \n"
"	B	loc_FF8CA954 \n"
"	B	loc_FF8CA954 \n"
"	B	loc_FF8CA954 \n"
"	B	loc_FF8CA954 \n"
"	B	loc_FF8CA95C \n"
"	B	loc_FF8CA960 \n"
"	B	loc_FF8CA960 \n"
"	B	loc_FF8CA960 \n"
"	B	loc_FF8CA960 \n"
"	B	loc_FF8CA960 \n"
"	B	loc_FF8CA960 \n"
"	B	loc_FF8CA830 \n"
"	B	loc_FF8CA838 \n"
"	B	loc_FF8CA838 \n"
"	B	loc_FF8CA84C \n"
"	B	loc_FF8CA84C \n"
"	B	loc_FF8CA854 \n"
"	B	loc_FF8CA88C \n"
"	B	loc_FF8CA8C4 \n"
"	B	loc_FF8CA8FC \n"
"	B	loc_FF8CA934 \n"
"	B	loc_FF8CA934 \n"
"	B	loc_FF8CA960 \n"
"	B	loc_FF8CA960 \n"
"	B	loc_FF8CA93C \n"
"	B	loc_FF8CA944 \n"
"loc_FF8CA818:\n"
"	BL	sub_FF8C5CB4 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA820:\n"
"	BL	sub_FF8C5FAC \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA828:\n"
"	BL	sub_FF8C6214 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA830:\n"
"	BL	sub_FF8C64C8 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA838:\n"
"	BL	sub_FF8C66E0 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA840:\n"
//"	BL	sub_FF8C6B9C \n"
"	BL	sub_FF8C6B9C_my \n"   // -->
"	MOV	R8, #0 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA84C:\n"
"	BL	sub_FF8C6D7C \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA854:\n"
"	LDRH	R1, [R0, #4] \n"
"	STRH	R1, [SP, #0x14] \n"
"	LDRH	R1, [R4, #2] \n"
"	STRH	R1, [SP, #0x16] \n"
"	LDRH	R1, [R4, #4] \n"
"	STRH	R1, [SP, #0x18] \n"
"	LDRH	R1, [R4, #6] \n"
"	STRH	R1, [SP, #0x1A] \n"
"	LDRH	R1, [R0, #0xC] \n"
"	STRH	R1, [SP, #0x1C] \n"
"	LDRH	R1, [R4, #0xA] \n"
"	STRH	R1, [SP, #0x1E] \n"
"	BL	sub_FF8CB8E4 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA88C:\n"
"	LDRH	R1, [R0, #4] \n"
"	STRH	R1, [SP, #0x14] \n"
"	LDRH	R1, [R4, #2] \n"
"	STRH	R1, [SP, #0x16] \n"
"	LDRH	R1, [R4, #4] \n"
"	STRH	R1, [SP, #0x18] \n"
"	LDRH	R1, [R4, #6] \n"
"	STRH	R1, [SP, #0x1A] \n"
"	LDRH	R1, [R4, #8] \n"
"	STRH	R1, [SP, #0x1C] \n"
"	LDRH	R1, [R4, #0xA] \n"
"	STRH	R1, [SP, #0x1E] \n"
"	BL	sub_FF8CBA64 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA8C4:\n"
"	LDRH	R1, [R4] \n"
"	STRH	R1, [SP, #0x14] \n"
"	LDRH	R1, [R0, #6] \n"
"	STRH	R1, [SP, #0x16] \n"
"	LDRH	R1, [R4, #4] \n"
"	STRH	R1, [SP, #0x18] \n"
"	LDRH	R1, [R4, #6] \n"
"	STRH	R1, [SP, #0x1A] \n"
"	LDRH	R1, [R4, #8] \n"
"	STRH	R1, [SP, #0x1C] \n"
"	LDRH	R1, [R4, #0xA] \n"
"	STRH	R1, [SP, #0x1E] \n"
"	BL	sub_FF8CBB18 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA8FC:\n"
"	LDRH	R1, [R4] \n"
"	STRH	R1, [SP, #0x14] \n"
"	LDRH	R1, [R4, #2] \n"
"	STRH	R1, [SP, #0x16] \n"
"	LDRH	R1, [R4, #4] \n"
"	STRH	R1, [SP, #0x18] \n"
"	LDRH	R1, [R4, #6] \n"
"	STRH	R1, [SP, #0x1A] \n"
"	LDRH	R1, [R0, #0xC] \n"
"	STRH	R1, [SP, #0x1C] \n"
"	LDRH	R1, [R4, #0xA] \n"
"	STRH	R1, [SP, #0x1E] \n"
"	BL	sub_FF8CBBC0 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA934:\n"
"	BL	sub_FF8C7278 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA93C:\n"
"	BL	sub_FF8C7A5C \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA944:\n"
"	BL	sub_FF8C7F80 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA94C:\n"
"	BL	sub_FF8C8160 \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA954:\n"
"	BL	sub_FF8C831C \n"
"	B	loc_FF8CA960 \n"
"loc_FF8CA95C:\n"
"	BL	sub_FF8C848C \n"
"loc_FF8CA960:\n"
"	LDR	R0, [SP, #0x20] \n"
"	LDR	R1, [R0, #0x7C] \n"
"	LDR	R2, [R0, #0x90] \n"
"	LDR	R3, [R0, #0x8C] \n"
"loc_FF8CA970:\n"
"	ADD	R0, R0, #4 \n"
"	BLX	R3 \n"
"loc_FF8CA978:\n"
"	LDR	R1, [SP, #0x20] \n"
"	LDR	R0, [R1] \n"
"	CMP	R0, #0x10 \n"
"	BEQ	loc_FF8CA9B0 \n"
"	BGT	loc_FF8CA9A0 \n"
"	CMP	R0, #1 \n"
"	CMPNE	R0, #4 \n"
"	CMPNE	R0, #0xE \n"
"	BNE	loc_FF8CA9C0 \n"
"	B	loc_FF8CA9B0 \n"
"loc_FF8CA9A0:\n"
"	CMP	R0, #0x13 \n"
"	CMPNE	R0, #0x17 \n"
"	CMPNE	R0, #0x1A \n"
"	BNE	loc_FF8CA9C0 \n"
"loc_FF8CA9B0:\n"
"	LDRH	R0, [R4] \n"
"	STRH	R0, [SP, #0x14] \n"
"	LDRH	R0, [R4, #8] \n"
"	STRH	R0, [SP, #0x1C] \n"
"loc_FF8CA9C0:\n"
"       CMP     R8, #1 \n"
"       BNE     loc_FF8CAA0C \n"
"       LDR     R0, [R1, #0x7C] \n"
"       MOV     R2, #0xC \n"
"       ADD     R0, R0, R0, LSL #1 \n"
"       ADD     R0, R1, R0, LSL #2 \n"
"       SUB     R8, R0, #8 \n"
"       LDR     R0, =0x5874C \n"
"       ADD     R1, SP, #0x14 \n"

"       BL      sub_FFB94078 \n"	// 1.01a
"       LDR     R0, =0x58758 \n"
"       MOV     R2, #0xC \n"
"       ADD     R1, SP, #0x14 \n"

"       BL      sub_FFB94078 \n"	// 1.01a
"       LDR     R0, =0x58764 \n"
"       MOV     R2, #0xC \n"
"       MOV     R1, R8 \n"

"       BL      sub_FFB94078 \n"	// 1.01a
"       B       loc_FF8CAA84 \n"
"loc_FF8CAA0C:\n"
"       LDR     R0, [R1] \n"
"       MOV     R3, #1 \n"
"       CMP     R0, #0xB \n"
"       BNE     loc_FF8CAA50 \n"
"       MOV     R2, #0 \n"
"       STRD    R2, [SP] \n"
"       MOV     R2, R3 \n"
"       MOV     R1, R3 \n"
"       MOV     R0, #0 \n"
"       BL      sub_FF8C5A94 \n"
"       MOV     R3, #1 \n"
"       MOV     R2, #0 \n"
"       STRD    R2, [SP] \n"
"       MOV     R2, R3 \n"
"       MOV     R1, R3 \n"
"       MOV     R0, #0 \n"
"       B       loc_FF8CAA80 \n"
"loc_FF8CAA50:\n"
"       MOV     R2, #1 \n"
"       STRD    R2, [SP] \n"
"       MOV     R3, R2 \n"
"       MOV     R1, R2 \n"
"       MOV     R0, R2 \n"
"       BL      sub_FF8C5A94 \n"
"       MOV     R3, #1 \n"
"       MOV     R2, R3 \n"
"       MOV     R1, R3 \n"
"       MOV     R0, R3 \n"
"       STR     R3, [SP] \n"
"       STR     R3, [SP, #4] \n"
"loc_FF8CAA80:\n"
"       BL      sub_FF8C5C00 \n"
"loc_FF8CAA84:\n"
"       LDR     R0, [SP, #0x20] \n"
"       BL      sub_FF8CB850 \n"
"       B       loc_FF8CA448 \n"
	);
}


//** sub_FF8C6B9C_my  @ 0xFF8C6B9C

void __attribute__((naked,noinline)) sub_FF8C6B9C_my(  ) {
asm volatile (
"	STMFD	SP!, {R4-R8,LR} \n"
"	LDR	R7, =0x4288 \n"
"	MOV	R4, R0 \n"
"	LDR	R0, [R7, #0x1C] \n"
"	MOV	R1, #0x3E \n"
"	BL	sub_FF88C660 \n"
"	MOV	R2, #0 \n"
"	LDRSH	R0, [R4, #4] \n"
"	MOV	R1, R2 \n"
"	BL	sub_FF8C573C \n"
"	MOV	R5, R0 \n"
"	LDRSH	R0, [R4, #6] \n"
"	BL	sub_FF8C588C \n"
"	LDRSH	R0, [R4, #8] \n"
"	BL	sub_FF8C58E4 \n"
"	LDRSH	R0, [R4, #0xA] \n"
"	BL	sub_FF8C593C \n"
"	LDRSH	R0, [R4, #0xC] \n"
"	MOV	R1, #0 \n"
"	BL	sub_FF8C5994 \n"
"	MOV	R6, R0 \n"
"	LDRSH	R0, [R4, #0xE] \n"
"	BL	sub_FF8CB880 \n"
"	LDR	R0, [R4] \n"
"	LDR	R8, =0x58764 \n"
"	CMP	R0, #0xB \n"
"	MOVEQ	R5, #0 \n"
"	MOVEQ	R6, R5 \n"
"	BEQ	loc_FF8C6C38 \n"
"	CMP	R5, #1 \n"
"	BNE	loc_FF8C6C38 \n"
"	LDRSH	R0, [R4, #4] \n"
"	LDR	R1, =0xFF8C569C \n"
"	MOV	R2, #2 \n"
"	BL	sub_FF978E74 \n"
"	STRH	R0, [R4, #4] \n"
"	MOV	R0, #0 \n"
"	STR	R0, [R7, #0x28] \n"
"	B	loc_FF8C6C40 \n"
"loc_FF8C6C38:\n"
"	LDRH	R0, [R8] \n"
"	STRH	R0, [R4, #4] \n"
"loc_FF8C6C40:\n"
"	CMP	R6, #1 \n"
"	LDRNEH	R0, [R8, #8] \n"
"	BNE	loc_FF8C6C5C \n"
"	LDRSH	R0, [R4, #0xC] \n"
"	LDR	R1, =0xFF8C5720 \n"
"	MOV	R2, #0x20 \n"
"	BL	sub_FF8CB8A0 \n"
"loc_FF8C6C5C:\n"
"	STRH	R0, [R4, #0xC] \n"
"	LDRSH	R0, [R4, #6] \n"
//"	BL	sub_FF8B6E2C \n"
"	BL	sub_FF8B6E2C_my \n"
"	B	sub_FF8C6C68 \n"	// continue in firmware
	);
}


//** sub_FF8B6E2C_my  @ 0xFF8B6E2C

void __attribute__((naked,noinline)) sub_FF8B6E2C_my(  ) {
asm volatile (
"	STMFD	SP!, {R4-R6,LR} \n"
"	LDR	R5, =0x3F30 \n"
"	MOV	R4, R0 \n"
"	LDR	R0, [R5, #4] \n"
"	CMP	R0, #1 \n"
"	LDRNE	R1, =0x146 \n"
"	LDRNE	R0, =0xFF8B6C64 \n"
"	BLNE	sub_FF81EC88 \n"
"	CMN	R4, #0xC00 \n"
"	LDREQSH	R4, [R5, #2] \n"
"	CMN	R4, #0xC00 \n"
"	MOVEQ	R1, #0x14C \n"
"	LDREQ	R0, =0xFF8B6C64 \n"
"	STRH	R4, [R5, #2] \n"
"	BLEQ	sub_FF81EC88 \n"
"	MOV	R0, R4 \n"
"	BL	apex2us \n"
"	B	sub_FF8B6E70   \n"  // continue in firmware
	);
}
