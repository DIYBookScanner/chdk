/*
 * capt_seq.c - auto-generated by CHDK code_gen.
 */
#include "lolevel.h"
#include "platform.h"
#include "core.h"

#define USE_STUBS_NRFLAG 1          // see stubs_entry.S
#define NR_AUTO (0)                 // have to explictly reset value back to 0 to enable auto
#define PAUSE_FOR_FILE_COUNTER 300  // Enable delay in capt_seq_hook_raw_here to ensure file counter is updated

#include "../../../generic/capt_seq.c"

/*************************************************************/
//** capt_seq_task @ 0xFF0A2FF4 - 0xFF0A331C, length=203
void __attribute__((naked,noinline)) capt_seq_task() {
asm volatile (
"    STMFD   SP!, {R3-R9,LR} \n"
"    LDR     R4, =0x9DDA4 \n"
"    LDR     R7, =0x3540 \n"
"    MOV     R6, #0 \n"

"loc_FF0A3004:\n"
"    LDR     R0, [R7, #4] \n"
"    MOV     R2, #0 \n"
"    MOV     R1, SP \n"
"    BL      sub_0068EF6C /*_ReceiveMessageQueue*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF0A3030 \n"
"    LDR     R1, =0x493 \n"
"    LDR     R0, =0xFF0A2ADC \n"
"    BL      _DebugAssert \n"
"    BL      _ExitTask \n"
"    LDMFD   SP!, {R3-R9,PC} \n"

"loc_FF0A3030:\n"
"    LDR     R0, [SP] \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x23 \n"
"    ADDCC   PC, PC, R1, LSL#2 \n"
"    B       loc_FF0A32E4 \n"
"    B       loc_FF0A30D0 \n"
"    B       loc_FF0A30E8 \n"
"    B       loc_FF0A316C \n"
"    B       loc_FF0A3180 \n"
"    B       loc_FF0A3178 \n"
"    B       loc_FF0A318C \n"
"    B       loc_FF0A3194 \n"
"    B       loc_FF0A319C \n"
"    B       loc_FF0A31B8 \n"
"    B       loc_FF0A320C \n"
"    B       loc_FF0A31C4 \n"
"    B       loc_FF0A31D0 \n"
"    B       loc_FF0A31D8 \n"
"    B       loc_FF0A31F4 \n"
"    B       loc_FF0A31FC \n"
"    B       loc_FF0A3204 \n"
"    B       loc_FF0A3214 \n"
"    B       loc_FF0A321C \n"
"    B       loc_FF0A3224 \n"
"    B       loc_FF0A322C \n"
"    B       loc_FF0A3234 \n"
"    B       loc_FF0A3240 \n"
"    B       loc_FF0A3248 \n"
"    B       loc_FF0A3250 \n"
"    B       loc_FF0A3258 \n"
"    B       loc_FF0A3260 \n"
"    B       loc_FF0A326C \n"
"    B       loc_FF0A3274 \n"
"    B       loc_FF0A327C \n"
"    B       loc_FF0A3284 \n"
"    B       loc_FF0A328C \n"
"    B       loc_FF0A3298 \n"
"    B       loc_FF0A32A0 \n"
"    B       loc_FF0A32AC \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A30D0:\n"
"    BL      shooting_expo_iso_override\n"      // added
"    BL      sub_FF0A38A0 \n"
"    BL      shooting_expo_param_override\n"    // added
"    BL      sub_FF0A0484 \n"
"    MOV     R0, #0\n"                          // added
"    STR     R0, [R4,#0x28]\n"                  // added, fixes overrides behavior at short shutter press (from S95)
//"  LDR     R0, [R4, #0x28] \n"  // above patch makes these three lines redundant
//"  CMP     R0, #0 \n"
//"  BLNE    _sub_FF219BE4 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A30E8:\n"
"    LDR     R5, [R0, #0x10] \n"
"    LDR     R0, [R4, #0x28] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF0A3130 \n"
"    LDR     R0, [R4, #0x8C] \n"
"    TST     R0, #0x30 \n"
"    BLNE    sub_FF0A6FF0 \n"
"    BL      sub_FF0A6BB4 \n"
"    MOV     R1, R5 \n"
"    BL      sub_FF0A6C0C \n"
"    LDR     R0, =0x10F \n"
"    MOV     R2, #4 \n"
"    ADD     R1, R5, #0x40 \n"
"    BL      _SetPropertyCase \n"
"    MOV     R2, #4 \n"
"    ADD     R1, R5, #0x44 \n"
"    MOV     R0, #0x2C \n"
"    BL      _SetPropertyCase \n"

"loc_FF0A3130:\n"
"    MOV     R0, R5 \n"
"    BL      sub_FF2199FC_my \n"  // --> Patched. Old value = 0xFF2199FC.
"    BL      capt_seq_hook_raw_here\n"      // added
"    MOV     R8, R0 \n"
"    MOV     R2, R5 \n"
"    MOV     R1, #1 \n"
"    BL      sub_FF0A0F34 \n"
"    TST     R8, #1 \n"
"    BNE     loc_FF0A32F0 \n"
"    MOV     R0, R5 \n"
"    BL      sub_FF218AF4 \n"
"    LDR     R0, [R4, #0x8C] \n"
"    TST     R0, #2 \n"
"    MOVNE   R0, R5 \n"
"    BLNE    sub_FF0A10D4 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A316C:\n"
"    MOV     R0, #1 \n"
"    BL      sub_FF0A3BA8 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3178:\n"
"    BL      sub_FF0A34C4 \n"
"    B       loc_FF0A3184 \n"

"loc_FF0A3180:\n"
"    BL      sub_FF0A3880 \n"

"loc_FF0A3184:\n"
"    STR     R6, [R4, #0x28] \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A318C:\n"
"    BL      sub_FF0A3888 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3194:\n"
"    BL      sub_FF0A3A7C \n"
"    B       loc_FF0A31BC \n"

"loc_FF0A319C:\n"
"    LDR     R5, [R0, #0x10] \n"
"    MOV     R0, R5 \n"
"    BL      sub_FF219C7C \n"
"    MOV     R2, R5 \n"
"    MOV     R1, #9 \n"
"    BL      sub_FF0A0F34 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A31B8:\n"
"    BL      sub_FF0A3B0C \n"

"loc_FF0A31BC:\n"
"    BL      sub_FF0A0484 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A31C4:\n"
"    LDR     R0, [R4, #0x58] \n"
"    BL      sub_FF0A41D0 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A31D0:\n"
"    BL      sub_FF0A44C8 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A31D8:\n"
"    LDRH    R1, [R4] \n"
"    SUB     R0, R1, #0x8200 \n"
"    SUBS    R0, R0, #0x39 \n"
"    MOVNE   R0, #0 \n"
"    MOVEQ   R0, #1 \n"
"    BL      sub_FF0A452C \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A31F4:\n"
"    BL      sub_FF0A4720 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A31FC:\n"
"    BL      sub_FF0A4B9C \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3204:\n"
"    BL      sub_FF0A4C50 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A320C:\n"
"    BL      sub_FF0A3880 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3214:\n"
"    BL      sub_FF217DE4 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A321C:\n"
"    BL      sub_FF21804C \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3224:\n"
"    BL      sub_FF218104 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A322C:\n"
"    BL      sub_FF2181D8 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3234:\n"
"    MOV     R0, #0 \n"
"    BL      sub_FF218438 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3240:\n"
"    BL      sub_FF2185A8 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3248:\n"
"    BL      sub_FF21863C \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3250:\n"
"    BL      sub_FF2186F8 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3258:\n"
"    BL      sub_FF0A3D20 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3260:\n"
"    BL      sub_FF0A3DA4 \n"
"    BL      sub_FF038CCC \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A326C:\n"
"    BL      sub_FF2182A8 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3274:\n"
"    BL      sub_FF2182E8 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A327C:\n"
"    BL      sub_FF0A82EC \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3284:\n"
"    BL      sub_FF0A836C \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A328C:\n"
"    LDR     R0, [R0, #0xC] \n"
"    BL      sub_FF218820 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A3298:\n"
"    BL      sub_FF218890 \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A32A0:\n"
"    BL      sub_FF0A83D4 \n"
"    BL      sub_FF0A838C \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A32AC:\n"
"    MOV     R0, #1 \n"
"    BL      sub_FF21A410 \n"
"    MOV     R0, #1 \n"
"    BL      sub_FF21A538 \n"
"    LDRH    R0, [R4, #0x9C] \n"
"    CMP     R0, #4 \n"
"    LDRNEH  R0, [R4] \n"
"    SUBNE   R1, R0, #0x8200 \n"
"    SUBNES  R1, R1, #0x2E \n"
"    BNE     loc_FF0A32F0 \n"
"    BL      sub_FF0A836C \n"
"    BL      sub_FF0A8ABC \n"
"    BL      sub_FF0A87FC \n"
"    B       loc_FF0A32F0 \n"

"loc_FF0A32E4:\n"
"    LDR     R1, =0x5F4 \n"
"    LDR     R0, =0xFF0A2ADC \n"
"    BL      _DebugAssert \n"

"loc_FF0A32F0:\n"
"    LDR     R0, [SP] \n"
"    LDR     R1, [R0, #4] \n"
"    LDR     R0, [R7] \n"
"    BL      sub_0068ECDC /*_SetEventFlag*/ \n"
"    LDR     R5, [SP] \n"
"    LDR     R0, [R5, #8] \n"
"    CMP     R0, #0 \n"
"    LDREQ   R1, =0x117 \n"
"    LDREQ   R0, =0xFF0A2ADC \n"
"    BLEQ    _DebugAssert \n"
"    STR     R6, [R5, #8] \n"
"    B       loc_FF0A3004 \n"
);
}

/*************************************************************/
//** sub_FF2199FC_my @ 0xFF2199FC - 0xFF219BE0, length=122
void __attribute__((naked,noinline)) sub_FF2199FC_my() {
asm volatile (
"    STMFD   SP!, {R3-R7,LR} \n"
"    LDR     R5, =0x9DDA4 \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R5, #0x28] \n"
"    MOV     R6, #0 \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF219A94 \n"
"    LDR     R1, [R5, #0x8C] \n"
"    TST     R1, #6 \n"
"    BNE     loc_FF219A38 \n"
"    MOV     R0, #0xC \n"
"    BL      sub_FF0AA124 \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF219A94 \n"
"    B       loc_FF219A8C \n"

"loc_FF219A38:\n"
"    LDRH    R0, [R5, #0x9A] \n"
"    CMP     R0, #3 \n"
"    LDRNE   R0, [R4, #8] \n"
"    CMPNE   R0, #1 \n"
"    BLS     loc_FF219A74 \n"
"    LDRH    R0, [R5, #0x96] \n"
"    CMP     R0, #3 \n"
"    BNE     loc_FF219A60 \n"
"    TST     R1, #2 \n"
"    BNE     loc_FF219A94 \n"

"loc_FF219A60:\n"
"    BL      sub_FF023F74 \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF219A94 \n"
"    BL      sub_FF0AA18C \n"
"    B       loc_FF219A8C \n"

"loc_FF219A74:\n"
"    MOV     R0, #0xC \n"
"    BL      sub_FF0AA124 \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF219A94 \n"
"    BL      sub_FF21A2A8 \n"
"    BL      sub_FF0A0BA0 \n"

"loc_FF219A8C:\n"
"    MOV     R0, #1 \n"
"    LDMFD   SP!, {R3-R7,PC} \n"

"loc_FF219A94:\n"
"    BL      sub_FF0A3890 \n"
"    LDR     R0, [R5, #0x28] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF219BCC \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF218A30 \n"
"    TST     R0, #1 \n"
"    LDMNEFD SP!, {R3-R7,PC} \n"
"    LDR     R0, [R5, #0x8C] \n"
"    AND     R0, R0, #0x40 \n"
"    CMP     R0, #0 \n"
"    LDRNEH  R0, [R5, #0x9A] \n"
"    CMPNE   R0, #3 \n"
"    LDRNE   R0, [R4, #8] \n"
"    CMPNE   R0, #1 \n"
"    BLS     loc_FF219AF0 \n"
"    BL      sub_FF21A6F8 \n"
"    MOV     R3, #0xC0 \n"
"    STR     R3, [SP] \n"
"    LDR     R2, =0x3A98 \n"
"    LDR     R3, =0xFF219D08 \n"
"    MOV     R1, #0x8000 \n"
"    BL      sub_FF0AA39C \n"

"loc_FF219AF0:\n"
"    LDR     R0, [R5, #0x8C] \n"
"    AND     R0, R0, #6 \n"
"    CMP     R0, #0 \n"
"    LDRNEH  R0, [R5, #0x9A] \n"
"    CMPNE   R0, #3 \n"
"    LDRNE   R0, [R4, #8] \n"
"    CMPNE   R0, #1 \n"
"    BHI     loc_FF219B1C \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF218E3C \n"
"    BL      sub_FF21A1EC \n"

"loc_FF219B1C:\n"

"    BL      wait_until_remote_button_is_released\n"    // added
"    BL      capt_seq_hook_set_nr\n"                    // added

"    LDR     R0, [R5, #0x8C] \n"
"    TST     R0, #0x40 \n"
"    BEQ     loc_FF219B84 \n"
"    LDR     R0, =0x181 \n"
"    MOV     R2, #4 \n"
"    MOV     R1, SP \n"
"    BL      _GetPropertyCase \n"
"    TST     R0, #1 \n"
"    MOVNE   R1, #0xD4 \n"
"    LDRNE   R0, =0xFF219D08 \n"
"    BLNE    _DebugAssert \n"
"    LDR     R0, [SP] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF219B64 \n"
"    BL      sub_FF21A6F8 \n"
"    MOV     R1, #0x8000 \n"
"    BL      sub_0068ECDC /*_SetEventFlag*/ \n"
"    B       loc_FF219B84 \n"

"loc_FF219B64:\n"
"    BL      sub_FF21A6F8 \n"
"    MOV     R1, #0x8000 \n"
"    BL      sub_0068ED10 /*_ClearEventFlag*/ \n"
"    LDR     R2, =0xFF2199E8 \n"
"    LDR     R0, [SP] \n"
"    MOV     R3, #0x8000 \n"
"    MOV     R1, R2 \n"
"    BL      sub_FF03B6B0 /*_SetTimerAfter*/ \n"

"loc_FF219B84:\n"
"    LDR     R0, [R5, #0x8C] \n"
"    AND     R0, R0, #6 \n"
"    CMP     R0, #0 \n"
"    LDRNEH  R0, [R5, #0x9A] \n"
"    CMPNE   R0, #3 \n"
"    LDRNE   R0, [R4, #8] \n"
"    CMPNE   R0, #1 \n"
"    MOVLS   R0, #2 \n"
"    BLLS    sub_FF0AB8E0 \n"
"    LDR     R0, [R5, #0x8C] \n"
"    TST     R0, #0x10 \n"
"    MOV     R0, R4 \n"
"    BEQ     loc_FF219BC0 \n"
"    BL      sub_FF3E688C \n"
"    B       loc_FF219BC4 \n"

"loc_FF219BC0:\n"
"    BL      sub_FF219508 \n"

"loc_FF219BC4:\n"
"    MOV     R6, R0 \n"
"    B       loc_FF219BDC \n"

"loc_FF219BCC:\n"
"    LDR     R0, =0xB6D8 \n"
"    LDR     R0, [R0] \n"
"    CMP     R0, #0 \n"
"    MOVNE   R6, #0x1D \n"

"loc_FF219BDC:\n"
"    MOV     R0, R6 \n"
"    LDMFD   SP!, {R3-R7,PC} \n"
);
}

/*************************************************************/
//** exp_drv_task @ 0xFF0F05BC - 0xFF0F0C4C, length=421
void __attribute__((naked,noinline)) exp_drv_task() {
asm volatile (
"    STMFD   SP!, {R4-R9,LR} \n"
"    SUB     SP, SP, #0x2C \n"
"    LDR     R6, =0x4A6C \n"
"    LDR     R7, =0xBB8 \n"
"    LDR     R4, =0xBD680 \n"
"    MOV     R0, #0 \n"
"    ADD     R5, SP, #0x1C \n"
"    STR     R0, [SP, #0xC] \n"

"loc_FF0F05DC:\n"
"    LDR     R0, [R6, #0x20] \n"
"    MOV     R2, #0 \n"
"    ADD     R1, SP, #0x28 \n"
"    BL      sub_0068EF6C /*_ReceiveMessageQueue*/ \n"
"    LDR     R0, [SP, #0xC] \n"
"    CMP     R0, #1 \n"
"    BNE     loc_FF0F0628 \n"
"    LDR     R0, [SP, #0x28] \n"
"    LDR     R0, [R0] \n"
"    CMP     R0, #0x14 \n"
"    CMPNE   R0, #0x15 \n"
"    CMPNE   R0, #0x16 \n"
"    CMPNE   R0, #0x17 \n"
"    BEQ     loc_FF0F0788 \n"
"    CMP     R0, #0x2A \n"
"    BEQ     loc_FF0F0710 \n"
"    ADD     R1, SP, #0xC \n"
"    MOV     R0, #0 \n"
"    BL      sub_FF0F056C \n"

"loc_FF0F0628:\n"
"    LDR     R0, [SP, #0x28] \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x30 \n"
"    BNE     loc_FF0F0654 \n"
"    BL      sub_FF0F19B8 \n"
"    LDR     R0, [R6, #0x1C] \n"
"    MOV     R1, #1 \n"
"    BL      sub_0068ECDC /*_SetEventFlag*/ \n"
"    BL      _ExitTask \n"
"    ADD     SP, SP, #0x2C \n"
"    LDMFD   SP!, {R4-R9,PC} \n"

"loc_FF0F0654:\n"
"    CMP     R1, #0x2F \n"
"    BNE     loc_FF0F0670 \n"
"    LDR     R2, [R0, #0x8C]! \n"
"    LDR     R1, [R0, #4] \n"
"    MOV     R0, R1 \n"
"    BLX     R2 \n"
"    B       loc_FF0F0C44 \n"

"loc_FF0F0670:\n"
"    CMP     R1, #0x28 \n"
"    BNE     loc_FF0F06C0 \n"
"    LDR     R0, [R6, #0x1C] \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_0068ED10 /*_ClearEventFlag*/ \n"
"    LDR     R0, =0xFF0EB498 \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_FF1DFEF8 \n"
"    LDR     R0, [R6, #0x1C] \n"
"    MOV     R2, R7 \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_0068EC1C /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    LDRNE   R1, =0x1599 \n"
"    BNE     loc_FF0F077C \n"

"loc_FF0F06AC:\n"
"    LDR     R1, [SP, #0x28] \n"
"    LDR     R0, [R1, #0x90] \n"
"    LDR     R1, [R1, #0x8C] \n"
"    BLX     R1 \n"
"    B       loc_FF0F0C44 \n"

"loc_FF0F06C0:\n"
"    CMP     R1, #0x29 \n"
"    BNE     loc_FF0F0708 \n"
"    ADD     R1, SP, #0xC \n"
"    BL      sub_FF0F056C \n"
"    LDR     R0, [R6, #0x1C] \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_0068ED10 /*_ClearEventFlag*/ \n"
"    LDR     R0, =0xFF0EB4A8 \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_FF1E0098 \n"
"    LDR     R0, [R6, #0x1C] \n"
"    MOV     R2, R7 \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_0068EC1C /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF0F06AC \n"
"    LDR     R1, =0x15A3 \n"
"    B       loc_FF0F077C \n"

"loc_FF0F0708:\n"
"    CMP     R1, #0x2A \n"
"    BNE     loc_FF0F0720 \n"

"loc_FF0F0710:\n"
"    LDR     R0, [SP, #0x28] \n"
"    ADD     R1, SP, #0xC \n"
"    BL      sub_FF0F056C \n"
"    B       loc_FF0F06AC \n"

"loc_FF0F0720:\n"
"    CMP     R1, #0x2D \n"
"    BNE     loc_FF0F0738 \n"
"    BL      sub_FF0DB530 \n"
"    BL      sub_FF0DC21C \n"
"    BL      sub_FF0DBD84 \n"
"    B       loc_FF0F06AC \n"

"loc_FF0F0738:\n"
"    CMP     R1, #0x2E \n"
"    BNE     loc_FF0F0788 \n"
"    LDR     R0, [R6, #0x1C] \n"
"    MOV     R1, #4 \n"
"    BL      sub_0068ED10 /*_ClearEventFlag*/ \n"
"    LDR     R1, =0xFF0EB4C8 \n"
"    LDR     R0, =0xFFFFF400 \n"
"    MOV     R2, #4 \n"
"    BL      sub_FF0DAF80 \n"
"    BL      sub_FF0DB210 \n"
"    LDR     R0, [R6, #0x1C] \n"
"    MOV     R2, R7 \n"
"    MOV     R1, #4 \n"
"    BL      sub_0068EB38 /*_WaitForAnyEventFlag*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF0F06AC \n"
"    LDR     R1, =0x15CB \n"

"loc_FF0F077C:\n"
"    LDR     R0, =0xFF0EBCA8 \n"
"    BL      _DebugAssert \n"
"    B       loc_FF0F06AC \n"

"loc_FF0F0788:\n"
"    LDR     R0, [SP, #0x28] \n"
"    MOV     R8, #1 \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x12 \n"
"    CMPNE   R1, #0x13 \n"
"    BNE     loc_FF0F07F0 \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R0, R1, LSL#2 \n"
"    SUB     R1, R1, #8 \n"
"    LDMIA   R1, {R2,R3,R9} \n"
"    STMIA   R5, {R2,R3,R9} \n"
"    BL      sub_FF0EE730 \n"
"    LDR     R0, [SP, #0x28] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x8C] \n"
"    LDR     R2, [R0, #0x90] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    LDR     R0, [SP, #0x28] \n"
"    BL      sub_FF0F1DD8 \n"
"    LDR     R0, [SP, #0x28] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R2, [R0, #0x98] \n"
"    LDR     R3, [R0, #0x94] \n"
"    B       loc_FF0F0B08 \n"

"loc_FF0F07F0:\n"
"    CMP     R1, #0x14 \n"
"    CMPNE   R1, #0x15 \n"
"    CMPNE   R1, #0x16 \n"
"    CMPNE   R1, #0x17 \n"
"    BNE     loc_FF0F08A8 \n"
"    ADD     R3, SP, #0xC \n"
"    MOV     R2, SP \n"
"    ADD     R1, SP, #0x1C \n"
"    BL      sub_FF0EE990 \n"
"    CMP     R0, #1 \n"
"    MOV     R9, R0 \n"
"    CMPNE   R9, #5 \n"
"    BNE     loc_FF0F0844 \n"
"    LDR     R0, [SP, #0x28] \n"
"    MOV     R2, R9 \n"
"    LDR     R1, [R0, #0x7C]! \n"
"    LDR     R12, [R0, #0x10]! \n"
"    LDR     R3, [R0, #4] \n"
"    MOV     R0, SP \n"
"    BLX     R12 \n"
"    B       loc_FF0F087C \n"

"loc_FF0F0844:\n"
"    LDR     R0, [SP, #0x28] \n"
"    CMP     R9, #2 \n"
"    LDR     R3, [R0, #0x90] \n"
"    CMPNE   R9, #6 \n"
"    BNE     loc_FF0F0890 \n"
"    LDR     R12, [R0, #0x8C] \n"
"    MOV     R2, R9 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, SP \n"
"    BLX     R12 \n"
"    LDR     R0, [SP, #0x28] \n"
"    MOV     R2, SP \n"
"    ADD     R1, SP, #0x1C \n"
"    BL      sub_FF0F0244 \n"

"loc_FF0F087C:\n"
"    LDR     R0, [SP, #0x28] \n"
"    LDR     R2, [SP, #0xC] \n"
"    MOV     R1, R9 \n"
"    BL      sub_FF0F050C \n"
"    B       loc_FF0F0B10 \n"

"loc_FF0F0890:\n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R12, [R0, #0x8C] \n"
"    MOV     R2, R9 \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R12 \n"
"    B       loc_FF0F0B10 \n"

"loc_FF0F08A8:\n"
"    CMP     R1, #0x24 \n"
"    CMPNE   R1, #0x25 \n"
"    BNE     loc_FF0F08F4 \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R0, R1, LSL#2 \n"
"    SUB     R1, R1, #8 \n"
"    LDMIA   R1, {R2,R3,R9} \n"
"    STMIA   R5, {R2,R3,R9} \n"
"    BL      sub_FF0ED4B0 \n"
"    LDR     R0, [SP, #0x28] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x8C] \n"
"    LDR     R2, [R0, #0x90] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    LDR     R0, [SP, #0x28] \n"
"    BL      sub_FF0ED984 \n"
"    B       loc_FF0F0B10 \n"

"loc_FF0F08F4:\n"
"    ADD     R1, R0, #4 \n"
"    LDMIA   R1, {R2,R3,R9} \n"
"    STMIA   R5, {R2,R3,R9} \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x28 \n"
"    ADDCC   PC, PC, R1, LSL#2 \n"
"    B       loc_FF0F0AF8 \n"
"    B       loc_FF0F09B0 \n"
"    B       loc_FF0F09B0 \n"
"    B       loc_FF0F09B8 \n"
"    B       loc_FF0F09C0 \n"
"    B       loc_FF0F09C0 \n"
"    B       loc_FF0F09C0 \n"
"    B       loc_FF0F09B0 \n"
"    B       loc_FF0F09B8 \n"
"    B       loc_FF0F09C0 \n"
"    B       loc_FF0F09C0 \n"
"    B       loc_FF0F09D8 \n"
"    B       loc_FF0F09D8 \n"
"    B       loc_FF0F0AE4 \n"
"    B       loc_FF0F0AEC \n"
"    B       loc_FF0F0AEC \n"
"    B       loc_FF0F0AEC \n"
"    B       loc_FF0F0AEC \n"
"    B       loc_FF0F0AF4 \n"
"    B       loc_FF0F0AF8 \n"
"    B       loc_FF0F0AF8 \n"
"    B       loc_FF0F0AF8 \n"
"    B       loc_FF0F0AF8 \n"
"    B       loc_FF0F0AF8 \n"
"    B       loc_FF0F0AF8 \n"
"    B       loc_FF0F09C8 \n"
"    B       loc_FF0F09D0 \n"
"    B       loc_FF0F09D0 \n"
"    B       loc_FF0F09D0 \n"
"    B       loc_FF0F09E4 \n"
"    B       loc_FF0F09E4 \n"
"    B       loc_FF0F09EC \n"
"    B       loc_FF0F0A24 \n"
"    B       loc_FF0F0A5C \n"
"    B       loc_FF0F0A94 \n"
"    B       loc_FF0F0ACC \n"
"    B       loc_FF0F0ACC \n"
"    B       loc_FF0F0AF8 \n"
"    B       loc_FF0F0AF8 \n"
"    B       loc_FF0F0AD4 \n"
"    B       loc_FF0F0ADC \n"

"loc_FF0F09B0:\n"
"    BL      sub_FF0EBADC \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F09B8:\n"
"    BL      sub_FF0EBDD4 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F09C0:\n"
"    BL      sub_FF0EC03C \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F09C8:\n"
"    BL      sub_FF0EC330 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F09D0:\n"
"    BL      sub_FF0EC548 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F09D8:\n"
"    BL      sub_FF0ECA38_my \n"  // --> Patched. Old value = 0xFF0ECA38.
"    MOV     R8, #0 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F09E4:\n"
"    BL      sub_FF0ECC14 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F09EC:\n"
"    LDRH    R1, [R0, #4] \n"
"    STRH    R1, [SP, #0x1C] \n"
"    LDRH    R1, [R4, #2] \n"
"    STRH    R1, [SP, #0x1E] \n"
"    LDRH    R1, [R4, #4] \n"
"    STRH    R1, [SP, #0x20] \n"
"    LDRH    R1, [R4, #6] \n"
"    STRH    R1, [SP, #0x22] \n"
"    LDRH    R1, [R0, #0xC] \n"
"    STRH    R1, [SP, #0x24] \n"
"    LDRH    R1, [R4, #0xA] \n"
"    STRH    R1, [SP, #0x26] \n"
"    BL      sub_FF0F1A4C \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F0A24:\n"
"    LDRH    R1, [R0, #4] \n"
"    STRH    R1, [SP, #0x1C] \n"
"    LDRH    R1, [R4, #2] \n"
"    STRH    R1, [SP, #0x1E] \n"
"    LDRH    R1, [R4, #4] \n"
"    STRH    R1, [SP, #0x20] \n"
"    LDRH    R1, [R4, #6] \n"
"    STRH    R1, [SP, #0x22] \n"
"    LDRH    R1, [R4, #8] \n"
"    STRH    R1, [SP, #0x24] \n"
"    LDRH    R1, [R4, #0xA] \n"
"    STRH    R1, [SP, #0x26] \n"
"    BL      sub_FF0F1BD8 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F0A5C:\n"
"    LDRH    R1, [R4] \n"
"    STRH    R1, [SP, #0x1C] \n"
"    LDRH    R1, [R0, #6] \n"
"    STRH    R1, [SP, #0x1E] \n"
"    LDRH    R1, [R4, #4] \n"
"    STRH    R1, [SP, #0x20] \n"
"    LDRH    R1, [R4, #6] \n"
"    STRH    R1, [SP, #0x22] \n"
"    LDRH    R1, [R4, #8] \n"
"    STRH    R1, [SP, #0x24] \n"
"    LDRH    R1, [R4, #0xA] \n"
"    STRH    R1, [SP, #0x26] \n"
"    BL      sub_FF0F1C8C \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F0A94:\n"
"    LDRH    R1, [R4] \n"
"    STRH    R1, [SP, #0x1C] \n"
"    LDRH    R1, [R4, #2] \n"
"    STRH    R1, [SP, #0x1E] \n"
"    LDRH    R1, [R4, #4] \n"
"    STRH    R1, [SP, #0x20] \n"
"    LDRH    R1, [R4, #6] \n"
"    STRH    R1, [SP, #0x22] \n"
"    LDRH    R1, [R0, #0xC] \n"
"    STRH    R1, [SP, #0x24] \n"
"    LDRH    R1, [R4, #0xA] \n"
"    STRH    R1, [SP, #0x26] \n"
"    BL      sub_FF0F1D34 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F0ACC:\n"
"    BL      sub_FF0ED264 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F0AD4:\n"
"    BL      sub_FF0EDA88 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F0ADC:\n"
"    BL      sub_FF0EDFE0 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F0AE4:\n"
"    BL      sub_FF0EE204 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F0AEC:\n"
"    BL      sub_FF0EE3C0 \n"
"    B       loc_FF0F0AF8 \n"

"loc_FF0F0AF4:\n"
"    BL      sub_FF0EE528 \n"

"loc_FF0F0AF8:\n"
"    LDR     R0, [SP, #0x28] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R2, [R0, #0x90] \n"
"    LDR     R3, [R0, #0x8C] \n"

"loc_FF0F0B08:\n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"

"loc_FF0F0B10:\n"
"    LDR     R0, [SP, #0x28] \n"
"    LDR     R0, [R0] \n"
"    CMP     R0, #0x10 \n"
"    BEQ     loc_FF0F0B48 \n"
"    BGT     loc_FF0F0B38 \n"
"    CMP     R0, #1 \n"
"    CMPNE   R0, #4 \n"
"    CMPNE   R0, #0xE \n"
"    BNE     loc_FF0F0B7C \n"
"    B       loc_FF0F0B48 \n"

"loc_FF0F0B38:\n"
"    CMP     R0, #0x13 \n"
"    CMPNE   R0, #0x17 \n"
"    CMPNE   R0, #0x1A \n"
"    BNE     loc_FF0F0B7C \n"

"loc_FF0F0B48:\n"
"    LDRSH   R0, [R4] \n"
"    CMN     R0, #0xC00 \n"
"    LDRNESH R1, [R4, #8] \n"
"    CMNNE   R1, #0xC00 \n"
"    STRNEH  R0, [SP, #0x1C] \n"
"    STRNEH  R1, [SP, #0x24] \n"
"    BNE     loc_FF0F0B7C \n"
"    ADD     R0, SP, #0x10 \n"
"    BL      sub_FF0F1FE8 \n"
"    LDRH    R0, [SP, #0x10] \n"
"    STRH    R0, [SP, #0x1C] \n"
"    LDRH    R0, [SP, #0x18] \n"
"    STRH    R0, [SP, #0x24] \n"

"loc_FF0F0B7C:\n"
"    LDR     R0, [SP, #0x28] \n"
"    CMP     R8, #1 \n"
"    BNE     loc_FF0F0BCC \n"
"    LDR     R1, [R0, #0x7C] \n"
"    MOV     R2, #0xC \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R0, R0, R1, LSL#2 \n"
"    SUB     R8, R0, #8 \n"
"    LDR     R0, =0xBD680 \n"
"    ADD     R1, SP, #0x1C \n"
"    BL      sub_006AB5FC \n"
"    LDR     R0, =0xBD68C \n"
"    MOV     R2, #0xC \n"
"    ADD     R1, SP, #0x1C \n"
"    BL      sub_006AB5FC \n"
"    LDR     R0, =0xBD698 \n"
"    MOV     R2, #0xC \n"
"    MOV     R1, R8 \n"
"    BL      sub_006AB5FC \n"
"    B       loc_FF0F0C44 \n"

"loc_FF0F0BCC:\n"
"    LDR     R0, [R0] \n"
"    MOV     R3, #1 \n"
"    CMP     R0, #0xB \n"
"    BNE     loc_FF0F0C10 \n"
"    MOV     R2, #0 \n"
"    STRD    R2, [SP] \n"
"    MOV     R2, R3 \n"
"    MOV     R1, R3 \n"
"    MOV     R0, #0 \n"
"    BL      sub_FF0EB8BC \n"
"    MOV     R3, #1 \n"
"    MOV     R2, #0 \n"
"    STRD    R2, [SP] \n"
"    MOV     R2, R3 \n"
"    MOV     R1, R3 \n"
"    MOV     R0, #0 \n"
"    B       loc_FF0F0C40 \n"

"loc_FF0F0C10:\n"
"    MOV     R2, #1 \n"
"    STRD    R2, [SP] \n"
"    MOV     R3, R2 \n"
"    MOV     R1, R2 \n"
"    MOV     R0, R2 \n"
"    BL      sub_FF0EB8BC \n"
"    MOV     R3, #1 \n"
"    MOV     R2, R3 \n"
"    MOV     R1, R3 \n"
"    MOV     R0, R3 \n"
"    STR     R3, [SP] \n"
"    STR     R3, [SP, #4] \n"

"loc_FF0F0C40:\n"
"    BL      sub_FF0EBA28 \n"

"loc_FF0F0C44:\n"
"    LDR     R0, [SP, #0x28] \n"
"    BL      sub_FF0F19B8 \n"
"    B       loc_FF0F05DC \n"
);
}

/*************************************************************/
//** sub_FF0ECA38_my @ 0xFF0ECA38 - 0xFF0ECAF8, length=49
void __attribute__((naked,noinline)) sub_FF0ECA38_my() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    LDR     R7, =0x4A6C \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R1, #0x3E \n"
"    BL      sub_0068ED10 /*_ClearEventFlag*/ \n"
"    MOV     R2, #0 \n"
"    LDRSH   R0, [R4, #4] \n"
"    MOV     R1, R2 \n"
"    BL      sub_FF0EB528 \n"
"    MOV     R6, R0 \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FF0EB6CC \n"
"    LDRSH   R0, [R4, #8] \n"
"    BL      sub_FF0EB724 \n"
"    LDRSH   R0, [R4, #0xA] \n"
"    BL      sub_FF0EB77C \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    MOV     R1, #0 \n"
"    BL      sub_FF0EB7D4 \n"
"    MOV     R5, R0 \n"
"    LDR     R0, [R4] \n"
"    LDR     R8, =0xBD698 \n"
"    CMP     R0, #0xB \n"
"    MOVEQ   R6, #0 \n"
"    MOVEQ   R5, R6 \n"
"    BEQ     loc_FF0ECACC \n"
"    CMP     R6, #1 \n"
"    BNE     loc_FF0ECACC \n"
"    LDRSH   R0, [R4, #4] \n"
"    LDR     R1, =0xFF0EB488 \n"
"    MOV     R2, #2 \n"
"    BL      sub_FF1DFF7C \n"
"    STRH    R0, [R4, #4] \n"
"    MOV     R0, #0 \n"
"    STR     R0, [R7, #0x28] \n"
"    B       loc_FF0ECAD4 \n"

"loc_FF0ECACC:\n"
"    LDRH    R0, [R8] \n"
"    STRH    R0, [R4, #4] \n"

"loc_FF0ECAD4:\n"
"    CMP     R5, #1 \n"
"    LDRNEH  R0, [R8, #8] \n"
"    BNE     loc_FF0ECAF0 \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    LDR     R1, =0xFF0EB50C \n"
"    MOV     R2, #0x20 \n"
"    BL      sub_FF0F1A08 \n"

"loc_FF0ECAF0:\n"
"    STRH    R0, [R4, #0xC] \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FF0DB27C_my \n"  // --> Patched. Old value = 0xFF0DB27C.
"    LDR     PC, =0xFF0ECAFC \n"  // Continue in firmware
);
}

/*************************************************************/
//** sub_FF0DB27C_my @ 0xFF0DB27C - 0xFF0DB2BC, length=17
void __attribute__((naked,noinline)) sub_FF0DB27C_my() {
asm volatile (
"    STMFD   SP!, {R4-R6,LR} \n"
"    LDR     R5, =0x46BC \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R5, #4] \n"
"    CMP     R0, #1 \n"
"    LDRNE   R1, =0x14D \n"
"    LDRNE   R0, =0xFF0DB0B4 \n"
"    BLNE    _DebugAssert \n"
"    CMN     R4, #0xC00 \n"
"    LDREQSH R4, [R5, #2] \n"
"    CMN     R4, #0xC00 \n"
"    LDREQ   R1, =0x153 \n"
"    LDREQ   R0, =0xFF0DB0B4 \n"
"    STRH    R4, [R5, #2] \n"
"    BLEQ    _DebugAssert \n"
"    MOV     R0, R4 \n"
"    BL      apex2us \n"  // --> Patched. Old value = _apex2us.
"    LDR     PC, =0xFF0DB2C0 \n"  // Continue in firmware
);
}
