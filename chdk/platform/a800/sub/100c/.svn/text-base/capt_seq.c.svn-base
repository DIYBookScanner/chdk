#include "lolevel.h"
#include "platform.h"
#include "core.h"
#include "conf.h"

static long *nrflag = (long*)(0x5a8c+0x08);  // Found @ ffd1d88c & ffd1d8d0 - both from stubs_entry.s
#define NR_AUTO (0)                          // have to explictly reset value back to 0 to enable auto
#define PAUSE_FOR_FILE_COUNTER 150           // Enable delay in capt_seq_hook_raw_here to ensure file counter is updated

#include "../../../generic/capt_seq.c"		//here from defined NR_AUTO definido initializes nrflag


//ffc5b06c
void __attribute__((naked,noinline)) capt_seq_task() {
	asm volatile (
		"push	{r3, r4, r5, r6, r7, lr}\n"
		"ldr	r5, =0x33d88\n" //[pc, #836]	; ffc5b3bc: (00033d88) \n"
		"ldr	r6, =0x2710\n" //[pc, #-1060]	; ffc5ac58: (00002710) \n"
"loc_ffc5b078:\n"
		"mov	r2, #0\n"
		"ldr	r0, [r6, #4]\n"
		"mov	r1, sp\n"
		"BL		sub_FFC2905C\n"
		"tst	r0, #1\n"
		"BEQ	loc_ffc5b0a4\n"
		"ldr	r1, =0x476\n" //[pc, #872]	; ffc5b400: (00000476) \n"
		"ldr	r0, =0xffc5ac5c\n" //[pc, #864]	; ffc5b3fc: (ffc5ac5c)  **"SsShootTask.c"\n"
		"BL		_DebugAssert\n" //sub_FFC0F768
		"BL		_ExitTask\n"	//FFC0F520\n"
		"pop	{r3, r4, r5, r6, r7, pc}\n"
"loc_ffc5b0a4:\n"
		"ldr	r0, [sp]\n"
		"ldr	r1, [r0]\n"
		"cmp	r1, #30\n"
		"addcc	pc, pc, r1, lsl #2\n"
		"B	loc_ffc5b27c\n"
		"B	loc_ffc5b130\n"
		"B	loc_ffc5b138\n"
		"B	loc_ffc5b164\n"
		"B	loc_ffc5b178\n"
		"B	loc_ffc5b170\n"
		"B	loc_ffc5b180\n"
		"B	loc_ffc5b188\n"
		"B	loc_ffc5b194\n"
		"B	loc_ffc5b1b0\n"
		"B	loc_ffc5b178\n"
		"B	loc_ffc5b1b8\n"
		"B	loc_ffc5b1c4\n"
		"B	loc_ffc5b1cc\n"
		"B	loc_ffc5b1d4\n"
		"B	loc_ffc5b1dc\n"
		"B	loc_ffc5b1e4\n"
		"B	loc_ffc5b1ec\n"
		"B	loc_ffc5b1f4\n"
		"B	loc_ffc5b200\n"
		"B	loc_ffc5b208\n"
		"B	loc_ffc5b210\n"
		"B	loc_ffc5b218\n"
		"B	loc_ffc5b220\n"
		"B	loc_ffc5b22c\n"
		"B	loc_ffc5b234\n"
		"B	loc_ffc5b23c\n"
		"B	loc_ffc5b244\n"
		"B	loc_ffc5b24c\n"
		"B	loc_ffc5b258\n"
		"B	loc_ffc5b288\n"
"loc_ffc5b130:\n"
		//"BL		shooting_expo_iso_override\n"  		    // added - as ixus220 - but not defined for a800
		"BL		sub_FFC5B7BC\n"
		"BL      shooting_expo_param_override\n"      // +
		"B		loc_ffc5b18c\n"
"loc_ffc5b138:\n"
		"BL     wait_until_remote_button_is_released\n"	// +++ as in ixus310
		"BL     capt_seq_hook_set_nr\n"           		// +++ as in ixus310
		"ldr	r7, [r0, #12]\n"
		"mov	r0, r7\n"
		"BL		sub_FFD1CA20\n"
		"BL     capt_seq_hook_raw_here\n"           // as in ixus220				 
		"mov	r4, r0\n"
		"mov	r2, r7\n"
		"mov	r1, #1\n"
		"BL		sub_FFC59678\n"
		"tst	r4, #1\n"
		"moveq	r0, r7\n"
		"BLEQ	sub_FFD1C558\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b164:\n"
		"mov	r0, #1\n"
		"BL		sub_FFC5BA38\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b170:\n"
		"BL		sub_FFC5B494\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b178:\n" // ; 2 refs\n"
		"BL		sub_FFC5B79C\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b180:\n"
		"BL		sub_FFC5B7A4\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b188:\n"
		"BL		sub_FFC5B94C\n"
"loc_ffc5b18c:\n" // ; 2 refs\n"
		"BL		sub_FFC591B0\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b194:\n"
		"ldr	r4, [r0, #12]\n"
		"mov	r0, r4\n"
		"BL		sub_FFD1CAC8\n"
		"mov	r2, r4\n"
		"mov	r1, #9\n"
		"BL		sub_FFC59678\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1b0:\n"
		"BL		sub_FFC5B9B0\n"
		"B		loc_ffc5b18c\n"
"loc_ffc5b1b8:\n"
		"ldr	r0, [r5, #80]\n" //	; 0x50\n"
		"BL		sub_FFC5BE4C\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1c4:\n"
		"BL		sub_FFC5C194\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1cc:\n"
		"BL		sub_FFC5C1F8\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1d4:\n"
		"BL		sub_FFD1BAEC\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1dc:\n"
		"BL		sub_FFD1BCD8\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1e4:\n"
		"BL		sub_FFD1BD78\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1ec:\n"
		"BL		sub_FFD1BE38\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b1f4:\n"
		"mov	r0, #0\n"
		"BL		sub_FFD1C030\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b200:\n"
		"BL		sub_FFD1C19C\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b208:\n"
		"BL		sub_FFD1C240\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b210:\n"
		"BL		sub_FFD1C320\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b218:\n"
		"BL		sub_FFC5BBA0\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b220:\n"
		"BL		sub_FFC5BBCC\n"
		"BL		sub_FFC270EC\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b22c:\n"
		"BL		sub_FFD1BEFC\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b234:\n"
		"BL		sub_FFD1BF3C\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b23c:\n"
		"BL		sub_FFC5DFDC\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b244:\n"
		"BL		sub_FFC5E048\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b24c:\n"
		"BL		sub_FFC5E0A4\n"
		"BL		sub_FFC5E064\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b258:\n"
		"ldrh	r0, [r5, #144]\n" //	; 0x90\n"
		"cmp	r0, #4\n"
		"ldrneh	r0, [r5]\n"
		"subne	r1, r0, #33280\n" //	; 0x8200\n"
		"subnes	r1, r1, #42\n" //	; 0x2a\n"
		"BNE	loc_ffc5b288\n"
		"BL		sub_FFC5E048\n"
		"BL		sub_FFC5E3D8\n"
		"B		loc_ffc5b288\n"
"loc_ffc5b27c:\n"
		"ldr	r1, =0x5d7\n" //[pc, #384]	; ffc5b404: (000005d7) \n"
		"ldr	r0, =0xffc5ac5c\n" //[pc, #372]	; ffc5b3fc: (ffc5ac5c)  **"SsShootTask.c"\n"
		"BL		_DebugAssert\n"
"loc_ffc5b288:\n" //; 28 refs\n"
		"ldr	r0, [sp]\n"
		"ldr	r1, [r0, #4]\n"
		"ldr	r0, [r6]\n"
		"BL		sub_FFC28DCC\n"
		"ldr	r4, [sp]\n"
		"ldr	r0, [r4, #8]\n"
		"cmp	r0, #0\n"
		"ldreq	r0, =0xffc5ac5c\n" //[pc, #336]	; ffc5b3fc: (ffc5ac5c)  **"SsShootTask.c"\n"
		"moveq	r1, #280\n" //	; 0x118\n"
		"bleq	_DebugAssert\n"
		"mov	r0, #0\n"
		"str	r0, [r4, #8]\n"
		"B	loc_ffc5b078\n"
	);
}

/*************************************************************/
//ffc98190
void __attribute__((naked,noinline)) exp_drv_task(){
	asm volatile (
			"push	{r4, r5, r6, r7, r8, r9, lr}\n"
			"sub	sp, sp, #36\n" //	; 0x24\n"
			"ldr	r6, =0x39b4\n" //[pc, #-3336]	; ffc97498: (000039b4) \n"
			"ldr	r7, =0xbb8\n" //[pc, #-3420]	; ffc97448: (00000bb8) \n"
			"ldr	r4, =0x4f250\n" //[pc, #628]	; ffc9841c: (0004f250) \n"
			"mov	r0, #0\n"
			"add	r5, sp, #20\n"
			"str	r0, [sp, #16]\n"
"loc_ffc981b0:\n"
			"ldr	r0, [r6, #32]\n"
			"mov	r2, #0\n"
			"add	r1, sp, #32\n"
			"BL		sub_FFC2905C\n"
			"ldr	r0, [sp, #16]\n"
			"cmp	r0, #1\n"
			"BNE	loc_ffc981fc\n"
			"ldr	r0, [sp, #32]\n"
			"ldr	r0, [r0]\n"
			"cmp	r0, #20\n"
			"cmpne	r0, #21\n"
			"cmpne	r0, #22\n"
			"cmpne	r0, #23\n"
			"BEQ	loc_ffc9835c\n"
			"cmp	r0, #41\n"//	; 0x29\n"
			"BEQ	loc_ffc982e4\n"
			"add	r1, sp, #16\n"
			"mov	r0, #0\n"
			"BL		sub_FFC98140\n"
"loc_ffc981fc:\n"
			"ldr	r0, [sp, #32]\n"
			"ldr	r1, [r0]\n"
			"cmp	r1, #47\n" //	; 0x2f\n"
			"BNE	loc_ffc98228\n"
			"BL		sub_FFC9963C\n"
			"ldr	r0, [r6, #28]\n"
			"mov	r1, #1\n"
			"BL		sub_FFC28DCC\n"
			"BL		_ExitTask\n"	//FFC0F520\n"
			"add	sp, sp, #36\n" //	; 0x24\n"
			"pop	{r4, r5, r6, r7, r8, r9, pc}\n"
"loc_ffc98228:\n"
			"cmp	r1, #46\n" //	; 0x2e\n"
			"BNE	loc_ffc98244\n"
			"ldr	r2, [r0, #140]!\n" //	; 0x8c\n"
			"ldr	r1, [r0, #4]\n"
			"mov	r0, r1\n"
			"BLX	r2\n"
			"B		loc_ffc98858\n"
"loc_ffc98244:\n"
			"cmp	r1, #39\n" //	; 0x27\n"
			"BNE	loc_ffc98294\n"
			"ldr	r0, [r6, #28]\n"
			"mov	r1, #128\n" //	; 0x80\n"
			"BL		sub_FFC28E00\n"
			"ldr	r0, =0xffc93da8\n" //[pc, #-3604]	; ffc9744c: (ffc93da8) \n"
			"mov	r1, #128\n" //	; 0x80\n"
			"BL		sub_FFD13BC8\n"
			"ldr	r0, [r6, #28]\n"
			"mov	r2, r7\n"
			"mov	r1, #128\n" //	; 0x80\n"
			"BL		sub_FFC28D0C\n"
			"tst	r0, #1\n"
			"ldrne	r1, =0x1708\n" //[pc, #416]	; ffc98420: (00001708) \n"
			"BNE	loc_ffc98350\n"
"loc_ffc98280:\n" // ; 5 refs\n"
			"ldr	r1, [sp, #32]\n"
			"ldr	r0, [r1, #144]\n" //	; 0x90\n"
			"ldr	r1, [r1, #140]\n" //	; 0x8c\n"
			"BLX	r1\n"
			"B		loc_ffc98858\n"
"loc_ffc98294:\n"
			"cmp	r1, #40\n" //	; 0x28\n"
			"BNE	loc_ffc982dc\n"
			"add	r1, sp, #16\n"
			"BL		sub_FFC98140\n"
			"ldr	r0, [r6, #28]\n"
			"mov	r1, #256\n" //	; 0x100\n"
			"BL		sub_FFC28E00\n"
			"ldr	r0, =0xffc93db8\n" //[pc, #364]	; ffc98424: (ffc93db8) \n"
			"mov	r1, #256\n" //	; 0x100\n"
			"BL		sub_FFD13E58\n"
			"ldr	r0, [r6, #28]\n"
			"mov	r2, r7\n"
			"mov	r1, #256\n" //	; 0x100\n"
			"BL		sub_FFC28D0C\n"
			"tst	r0, #1\n"
			"BEQ	loc_ffc98280\n"
			"ldr	r1, =0x1712\n" //[pc, #332]	; ffc98428: (00001712) \n"
			"B		loc_ffc98350\n"
"loc_ffc982dc:\n"
			"cmp	r1, #41\n" //	; 0x29\n"
			"BNE	loc_ffc982f4\n"
"loc_ffc982e4:\n"
			"ldr	r0, [sp, #32]\n"
			"add	r1, sp, #16\n"
			"BL		sub_FFC98140\n"
			"B		loc_ffc98280\n"
"loc_ffc982f4:\n"
			"cmp	r1, #44\n" //	; 0x2c\n"
			"BNE	loc_ffc9830c\n"
			"BL		sub_FFC864C4\n"
			"BL		sub_FFC87150\n"
			"BL		sub_FFC86CC8\n"
			"B		loc_ffc98280\n"
"loc_ffc9830c:\n"
			"cmp	r1, #45\n" //	; 0x2d\n"
			"BNE	loc_ffc9835c\n"
			"ldr	r0, [r6, #28]\n"
			"mov	r1, #4\n"
			"BL		sub_FFC28E00\n"
			"ldr	r1, =0xffc93dd8\n" //[pc, #-3732]	; ffc97494: (ffc93dd8) \n"
			"ldr	r0, =0xfffff400\n" //[pc, #176]	; ffc983dc: (fffff400) \n"
			"mov	r2, #4\n"
			"BL		sub_FFC85F38\n"
			"BL		sub_FFC861C8\n"
			"ldr	r0, [r6, #28]\n"
			"mov	r2, r7\n"
			"mov	r1, #4\n"
			"BL		sub_FFC28C28\n"
			"tst	r0, #1\n"
			"BEQ	loc_ffc98280\n"
			"ldr	r1, =0x173a\n" //[pc, #216]	; ffc9842c: (0000173a) \n"
"loc_ffc98350:\n" // ; 2 refs\n"
			"ldr	r0,=0xffc944cc\n" // [pc, #-3844]	; ffc97454: (ffc944cc)  **"ExpDrv.c"\n"
			"BL		_DebugAssert\n" //sub_FFC0F768\n"
			"B		loc_ffc98280\n"
"loc_ffc9835c:\n" // ; 2 refs\n"
			"ldr	r0, [sp, #32]\n"
			"mov	r8, #1\n"
			"ldr	r1, [r0]\n"
			"cmp	r1, #18\n"
			"cmpne	r1, #19\n"
			"BNE	loc_ffc98430\n"
			"ldr	r1, [r0, #124]\n" //	; 0x7c\n"
			"add	r1, r1, r1, lsl #1\n"
			"add	r1, r0, r1, lsl #2\n"
			"sub	r1, r1, #8\n"
			"ldm	r1, {r2, r3, r9}\n"
			"stm	r5, {r2, r3, r9}\n"
			"BL		sub_FFC967A4\n"
			"ldr	r0, [sp, #32]\n"
			"ldr	r1, [r0, #124]\n" //	; 0x7c\n"
			"ldr	r3, [r0, #140]\n" //	; 0x8c\n"
			"ldr	r2, [r0, #144]\n" //	; 0x90\n"
"loc_ffc983a0:\n"
			"add	r0, r0, #4\n"
			"BLX	r3\n"
			"ldr	r0, [sp, #32]\n"
			"BL		sub_FFC999D8\n"
			"ldr	r0, [sp, #32]\n"
			"ldr	r1, [r0, #124]\n" //	; 0x7c\n"
			"ldr	r2, [r0, #152]\n" //	; 0x98\n"
			"ldr	r3, [r0, #148]\n" //	; 0x94\n"
			"B		loc_ffc98744\n"
"loc_ffc98430:\n"
			"cmp	r1, #20\n"
			"cmpne	r1, #21\n"
			"cmpne	r1, #22\n"
			"cmpne	r1, #23\n"
			"BNE	loc_ffc984e8\n"
			"add	r3, sp, #16\n"
			"add	r2, sp, #4\n"
			"add	r1, sp, #20\n"
			"BL		sub_FFC96A0C\n"
			"cmp	r0, #1\n"
			"mov	r9, r0\n"
			"cmpne	r9, #5\n"
			"BNE	loc_ffc98484\n"
			"ldr	r0, [sp, #32]\n"
			"mov	r2, r9\n"
			"ldr	r1, [r0, #124]!\n" //	; 0x7c\n"
			"ldr	ip, [r0, #16]!\n"
			"ldr	r3, [r0, #4]\n"
			"add	r0, sp, #4\n"
			"BLX	ip\n"
			"B		loc_ffc984bc\n"
"loc_ffc98484:\n"
			"ldr	r0, [sp, #32]\n"
			"cmp	r9, #2\n"
			"ldr	r3, [r0, #144]\n" //	; 0x90\n"
			"cmpne	r9, #6\n"
			"BNE	loc_ffc984d0\n"
			"ldr	ip, [r0, #140]\n" //	; 0x8c\n"
			"mov	r2, r9\n"
			"mov	r1, #1\n"
			"add	r0, sp, #4\n"
			"BLX	ip\n"
			"ldr	r0, [sp, #32]\n"
			"add	r2, sp, #4\n"
			"add	r1, sp, #20\n"
			"BL		sub_FFC97E8C\n"
"loc_ffc984bc:\n"
			"ldr	r0, [sp, #32]\n"
			"ldr	r2, [sp, #16]\n"
			"mov	r1, r9\n"
			"BL		sub_FFC980E0\n"
			"B		loc_ffc9874c\n"
"loc_ffc984d0:\n"
			"ldr	r1, [r0, #124]\n" //	; 0x7c\n"
			"ldr	ip, [r0, #140]\n" //	; 0x8c\n"
			"mov	r2, r9\n"
			"add	r0, r0, #4\n"
			"BLX	ip\n"
			"B	loc_ffc9874c\n"
"loc_ffc984e8:\n"
			"cmp	r1, #35\n" //	; 0x23\n"
			"cmpne	r1, #36\n" //	; 0x24\n"
			"BNE	loc_ffc98534\n"
			"ldr	r1, [r0, #124]\n" //	; 0x7c\n"
			"add	r1, r1, r1, lsl #1\n"
			"add	r1, r0, r1, lsl #2\n"
			"sub	r1, r1, #8\n"
			"ldm	r1, {r2, r3, r9}\n"
			"stm	r5, {r2, r3, r9}\n"
			"BL		sub_FFC95818\n"
			"ldr	r0, [sp, #32]\n"
			"ldr	r1, [r0, #124]\n" //	; 0x7c\n"
			"ldr	r3, [r0, #140]\n" //	; 0x8c\n"
			"ldr	r2, [r0, #144]\n" //	; 0x90\n"
			"add	r0, r0, #4\n"
			"BLX	r3\n"
			"ldr	r0, [sp, #32]\n"
			"BL		sub_FFC95C54\n"
			"B		loc_ffc9874c\n"
"loc_ffc98534:\n"
			"add	r1, r0, #4\n"
			"ldm	r1, {r2, r3, r9}\n"
			"stm	r5, {r2, r3, r9}\n"
			"ldr	r1, [r0]\n"
			"cmp	r1, #39\n" //	; 0x27\n"
			"addcc	pc, pc, r1, lsl #2\n"
			"B	loc_ffc98734\n"
			"B	loc_ffc985ec\n"
			"B	loc_ffc985ec\n"
			"B	loc_ffc985f4\n"
			"B	loc_ffc985fc\n"
			"B	loc_ffc985fc\n"
			"B	loc_ffc985fc\n"
			"B	loc_ffc985ec\n"
			"B	loc_ffc985f4\n"
			"B	loc_ffc985fc\n"
			"B	loc_ffc985fc\n"
			"B	loc_ffc98614\n"
			"B	loc_ffc98614\n"
			"B	loc_ffc98720\n"
			"B	loc_ffc98728\n"
			"B	loc_ffc98728\n"
			"B	loc_ffc98728\n"
			"B	loc_ffc98728\n"
			"B	loc_ffc98730\n"
			"B	loc_ffc98734\n"
			"B	loc_ffc98734\n"
			"B	loc_ffc98734\n"
			"B	loc_ffc98734\n"
			"B	loc_ffc98734\n"
			"B	loc_ffc98734\n"
			"B	loc_ffc98604\n"
			"B	loc_ffc9860c\n"
			"B	loc_ffc9860c\n"
			"B	loc_ffc98620\n"
			"B	loc_ffc98620\n"
			"B	loc_ffc98628\n"
			"B	loc_ffc98660\n"
			"B	loc_ffc98698\n"
			"B	loc_ffc986d0\n"
			"B	loc_ffc98708\n"
			"B	loc_ffc98708\n"
			"B	loc_ffc98734\n"
			"B	loc_ffc98734\n"
			"B	loc_ffc98710\n"
			"B	loc_ffc98718\n"
"loc_ffc985ec:\n" // ; 3 refs\n"
			"BL		sub_FFC94350\n"
			"B		loc_ffc98734\n"
"loc_ffc985f4:\n" // ; 2 refs\n"
			"BL		sub_FFC945F0\n"
			"B		loc_ffc98734\n"
"loc_ffc985fc:\n" // ; 5 refs\n"
			"BL		sub_FFC94818\n"
			"B		loc_ffc98734\n"
"loc_ffc98604:\n"
			"BL		sub_FFC94AF0\n"
			"B		loc_ffc98734\n"
"loc_ffc9860c:\n" // ; 2 refs\n"
			"BL		sub_FFC94D08\n"
			"B		loc_ffc98734\n"
"loc_ffc98614:\n" // ; 2 refs\n"
			"BL		sub_FFC95088_my\n"  //<<<<< patched
			"mov	r8, #0\n"
			"B		loc_ffc98734\n"
"loc_ffc98620:\n" // ; 2 refs\n"
			"BL		sub_FFC951D0\n"
			"B		loc_ffc98734\n"
"loc_ffc98628:\n"
			"ldrh	r1, [r0, #4]\n"
			"strh	r1, [sp, #20]\n"
			"ldrh	r1, [r4, #2]\n"
			"strh	r1, [sp, #22]\n"
			"ldrh	r1, [r4, #4]\n"
			"strh	r1, [sp, #24]\n"
			"ldrh	r1, [r4, #6]\n"
			"strh	r1, [sp, #26]\n"
			"ldrh	r1, [r0, #12]\n"
			"strh	r1, [sp, #28]\n"
			"ldrh	r1, [r4, #10]\n"
			"strh	r1, [sp, #30]\n"
			"BL		sub_FFC996D0\n"
			"B		loc_ffc98734\n"
"loc_ffc98660:\n"
			"ldrh	r1, [r0, #4]\n"
			"strh	r1, [sp, #20]\n"
			"ldrh	r1, [r4, #2]\n"
			"strh	r1, [sp, #22]\n"
			"ldrh	r1, [r4, #4]\n"
			"strh	r1, [sp, #24]\n"
			"ldrh	r1, [r4, #6]\n"
			"strh	r1, [sp, #26]\n"
			"ldrh	r1, [r4, #8]\n"
			"strh	r1, [sp, #28]\n"
			"ldrh	r1, [r4, #10]\n"
			"strh	r1, [sp, #30]\n"
			"BL		sub_FFC997D8\n"
			"B		loc_ffc98734\n"
"loc_ffc98698:\n"
			"ldrh	r1, [r4]\n"
			"strh	r1, [sp, #20]\n"
			"ldrh	r1, [r0, #6]\n"
			"strh	r1, [sp, #22]\n"
			"ldrh	r1, [r4, #4]\n"
			"strh	r1, [sp, #24]\n"
			"ldrh	r1, [r4, #6]\n"
			"strh	r1, [sp, #26]\n"
			"ldrh	r1, [r4, #8]\n"
			"strh	r1, [sp, #28]\n"
			"ldrh	r1, [r4, #10]\n"
			"strh	r1, [sp, #30]\n"
			"BL		sub_FFC9988C\n"
			"B		loc_ffc98734\n"
"loc_ffc986d0:\n"
			"ldrh	r1, [r4]\n"
			"strh	r1, [sp, #20]\n"
			"ldrh	r1, [r4, #2]\n"
			"strh	r1, [sp, #22]\n"
			"ldrh	r1, [r4, #4]\n"
			"strh	r1, [sp, #24]\n"
			"ldrh	r1, [r4, #6]\n"
			"strh	r1, [sp, #26]\n"
			"ldrh	r1, [r0, #12]\n"
			"strh	r1, [sp, #28]\n"
			"ldrh	r1, [r4, #10]\n"
			"strh	r1, [sp, #30]\n"
			"BL		sub_FFC99934\n"
			"B		loc_ffc98734\n"
"loc_ffc98708:\n" // ; 2 refs\n"
			"BL		sub_FFC9560C\n"
			"B		loc_ffc98734\n"
"loc_ffc98710:\n"
			"BL		sub_FFC95D58\n"
			"B		loc_ffc98734\n"
"loc_ffc98718:\n"
			"BL		sub_FFC96000\n"
			"B		loc_ffc98734\n"
"loc_ffc98720:\n"
			"BL		sub_FFC961E0\n"
			"B		loc_ffc98734\n"
"loc_ffc98728:\n" // ; 4 refs\n"
			"BL		sub_FFC9642C\n"
			"B		loc_ffc98734\n"
"loc_ffc98730:\n"
			"BL		sub_FFC9659C\n"
"loc_ffc98734:\n" // ; 25 refs\n"
			"ldr	r0, [sp, #32]\n"
			"ldr	r1, [r0, #124]\n" //	; 0x7c\n"
			"ldr	r2, [r0, #144]\n" //	; 0x90\n"
			"ldr	r3, [r0, #140]\n" //	; 0x8c\n"
"loc_ffc98744:\n"
			"add	r0, r0, #4\n"
			"BLX	r3\n"
"loc_ffc9874c:\n" // ; 3 refs\n"
			"ldr	r1, [sp, #32]\n"
			"ldr	r0, [r1]\n"
			"cmp	r0, #16\n"
			"BEQ	loc_ffc98784\n"
			"bgt	loc_ffc98774\n"
			"cmp	r0, #1\n"
			"cmpne	r0, #4\n"
			"cmpne	r0, #14\n"
			"BNE	loc_ffc98794\n"
			"B		loc_ffc98784\n"
"loc_ffc98774:\n"
			"cmp	r0, #19\n"
			"cmpne	r0, #23\n"
			"cmpne	r0, #26\n"
			"BNE	loc_ffc98794\n"
"loc_ffc98784:\n" // ; 2 refs\n"
			"ldrh	r0, [r4]\n"
			"strh	r0, [sp, #20]\n"
			"ldrh	r0, [r4, #8]\n"
			"strh	r0, [sp, #28]\n"
"loc_ffc98794:\n" // ; 2 refs\n"
			"cmp	r8, #1\n"
			"BNE	loc_ffc987e0\n"
			"ldr	r0, [r1, #124]\n" //	; 0x7c\n"
			"mov	r2, #12\n"
			"add	r0, r0, r0, lsl #1\n"
			"add	r0, r1, r0, lsl #2\n"
			"sub	r8, r0, #8\n"
			"ldr	r0, =0x4f250\n" //[pc, #-924]	; ffc9841c: (0004f250) \n"
			"add	r1, sp, #20\n"
			"BL		sub_FFE99884\n"
			"ldr	r0, =0x4f25c\n" //[pc, #3584]	; ffc995c4: (0004f25c) \n"
			"mov	r2, #12\n"
			"add	r1, sp, #20\n"
			"BL		sub_FFE99884\n"
			"ldr	r0, =0x4f268\n" //[pc, #-1024]	; ffc983d4: (0004f268) \n"
			"mov	r2, #12\n"
			"mov	r1, r8\n"
			"BL		sub_FFE99884\n"
			"B		loc_ffc98858\n"
"loc_ffc987e0:\n"
			"ldr	r0, [r1]\n"
			"mov	r3, #1\n"
			"cmp	r0, #11\n"
			"BNE	loc_ffc98824\n"
			"mov	r2, #0\n"
			"strd	r2, [sp]\n"
			"mov	r2, r3\n"
			"mov	r1, r3\n"
			"mov	r0, #0\n"
			"BL		sub_FFC94130\n"
			"mov	r3, #1\n"
			"mov	r2, #0\n"
			"strd	r2, [sp]\n"
			"mov	r2, r3\n"
			"mov	r1, r3\n"
			"mov	r0, #0\n"
			"B		loc_ffc98854\n"
"loc_ffc98824:\n"
			"mov	r2, #1\n"
			"strd	r2, [sp]\n"
			"mov	r3, r2\n"
			"mov	r1, r2\n"
			"mov	r0, r2\n"
			"BL		sub_FFC94130\n"
			"mov	r3, #1\n"
			"mov	r2, r3\n"
			"mov	r1, r3\n"
			"mov	r0, r3\n"
			"str	r3, [sp]\n"
			"str	r3, [sp, #4]\n"
"loc_ffc98854:\n"
			"BL		sub_FFC9429C\n"
"loc_ffc98858:\n" // ; 3 refs\n"
			"ldr	r0, [sp, #32]\n"
			"BL		sub_FFC9963C\n"
			"B		loc_ffc981b0\n"
	);
}

void __attribute__((naked,noinline)) sub_FFC95088_my() {
	asm volatile (
			"push	{r4, r5, r6, r7, r8, lr}\n"
			"ldr	r7, =0x39b4\n" //[pc, #-3036]	; ffc944b8: (000039b4) \n"
			"mov	r4, r0\n"
			"ldr	r0, [r7, #28]\n"
			"mov	r1, #62\n" //	; 0x3e\n"
			"BL		sub_FFC28E00\n"
			"mov	r2, #0\n"
			"ldrsh	r0, [r4, #4]\n"
			"mov	r1, r2\n"
			"BL		sub_FFC93E38\n"
			"mov	r5, r0\n"
			"ldrsh	r0, [r4, #6]\n"
			"BL		sub_FFC93F88\n"
			"ldrsh	r0, [r4, #8]\n"
			"BL		sub_FFC93FE0\n"
			"ldrsh	r0, [r4, #10]\n"
			"BL		sub_FFC94038\n"
			"ldrsh	r0, [r4, #12]\n"
			"mov	r1, #0\n"
			"BL		sub_FFC94090\n"
			"mov	r6, r0\n"
			"ldrsh	r0, [r4, #14]\n"
			"BL		sub_FFC9966C\n"
			"ldr	r0, [r4]\n"
			"ldr	r8, =0x4f268\n" //[pc, #-3120]	; ffc944c0: (0004f268) \n"
			"cmp	r0, #11\n"
			"moveq	r5, #0\n"
			"moveq	r6, r5\n"
			"BEQ	loc_ffc95124\n"
			"cmp	r5, #1\n"
			"BNE	loc_ffc95124\n"
			"ldrsh	r0, [r4, #4]\n"
			"ldr	r1, =0xffc93d98\n" //[pc, #-3116]	; ffc944e4: (ffc93d98) \n"
			"mov	r2, #2\n"
			"BL		sub_FFD13D1C\n"
			"strh	r0, [r4, #4]\n"
			"mov	r0, #0\n"
			"str	r0, [r7, #40]\n" //	; 0x28\n"
			"B		loc_ffc9512c\n"
"loc_ffc95124:\n" // ; 2 refs\n"
			"ldrh	r0, [r8]\n"
			"strh	r0, [r4, #4]\n"
"loc_ffc9512c:\n"
			"cmp	r6, #1\n"
			"ldrneh	r0, [r8, #8]\n"
			"BNE	loc_ffc95148\n"
			"ldrsh	r0, [r4, #12]\n"
			"ldr	r1, =0xffc93e1c\n" //[pc, #-3164]	; ffc944e8: (ffc93e1c) \n"
			"mov	r2, #32\n"
			"BL		sub_FFC9968C\n"
"loc_ffc95148:\n"
			"strh	r0, [r4, #12]\n"
			"ldrsh	r0, [r4, #6]\n"
			//"BL		sub_FFC86234\n"
			"BL		sub_FFC86234_my\n" 		//<<<<<< patched
			"B		sub_FFC95154\n" //segue na ROM
	);
}
void __attribute__((naked,noinline)) sub_FFC86234_my() {
	asm volatile (

			"push	{r4, r5, r6, lr}\n"
			"ldr	r5, =0x3680\n" //[pc, #-476]	; ffc86064: (00003680) \n"
			"mov	r4, r0\n"
			"ldr	r0, [r5, #4]\n"
			"cmp	r0, #1\n"
			"ldrne	r1, =0x146\n" //[pc, #980]	; ffc86624: (00000146) \n"
			"LDRNE	R0,=0xffc8606c\n" //"subne	r0, pc, #488	; ffc8606c: (74756853)  *"Shutter.c"\n"
			"BLNE	_DebugAssert\n" //sub_FFC0F768\n"
			"cmn	r4, #3072\n" //	; 0xc00\n"
			"ldreqsh	r4, [r5, #2]\n"
			"cmn	r4, #3072\n" //	; 0xc00\n"
			"moveq	r1, #332\n" //	; 0x14c\n"
			"LDREQ	R0,=0xffc8606c\n" //"subeq	r0, pc, #512	; ffc8606c: (74756853)  *"Shutter.c"\n"
			"strh	r4, [r5, #2]\n" //Em ixus220 ele usa LDRNE acima e a instruçãoé um subeq
			"BLEQ	_DebugAssert\n" //loc_ffc0f768\n"
			"mov	r0, r4\n"
			//"BL		_apex2us\n"	//"BL		sub_FFD8DFD0\n"  original
			"BL		apex2us\n"		 //+ =>>>>>>>> patched
			"B		sub_FFC86278\n"  //continues firmware
	);
}			
